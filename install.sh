#!/bin/bash
#
# GT-salat-dikr Complete Installation v3.2.5 - ุงูุฅุตุฏุงุฑ ุงููุญุณูู
# ูุน ุงูุญูุงุธ ุนูู ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ ูุฅุตูุงุญ ุงููุดููุงุช
#

set -e

# ุฏุงูุฉ ูุนุฑุถ ุงูุฑุฃุณ ุงูููู
show_header() {
    clear
    cat << "EOF"

      ___ _____    ___   _   _      _ _____    ___ ___ _  _____ 
     / __|_   _|__/ __| /_\ | |    /_\_   _|__|   \_ _| |/ / _ \
    | (_ | | ||___\__ \/ _ \| |__ / _ \| ||___| |) | || ' <|   /
     \___| |_|    |___/_/ \_\____/_/ \_\_|    |___/___|_|\_\_|_\
                                                                
     ๐ ูุธุงู ุฅุดุนุงุฑุงุช ุงูุตูุงุฉ ูุงูุฃุฐูุงุฑ - ุงูุฅุตุฏุงุฑ 3.2.5 ๐

EOF
}

show_header

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "     ุชุซุจูุช GT-salat-dikr - ุงูุฅุตุฏุงุฑ ุงููุญุณูู"
echo "     ูุน ุงูุญูุงุธ ุนูู ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ ูุชุญุณูููุง"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ุงูุชุญูู ูู ุนุฏู ุงูุชุดุบูู ูู root
if [ "$EUID" -eq 0 ]; then
    echo "โ๏ธ  ูุง ุชุดุบู ูุฐุง ุงูุณูุฑุจุช ุจุตูุงุญูุงุช root."
    exit 1
fi

INSTALL_DIR="$HOME/.GT-salat-dikr"
REPO_BASE="https://raw.githubusercontent.com/SalehGNUTUX/GT-salat-dikr/main"
MAIN_SCRIPT="gt-salat-dikr.sh"
CONFIG_FILE="$INSTALL_DIR/settings.conf"
TRAY_SCRIPT="$INSTALL_DIR/gt-tray.py"
DESKTOP_FILE="$INSTALL_DIR/gt-salat-dikr.desktop"
LAUNCHER_FILE="$INSTALL_DIR/launcher.sh"
UNIVERSAL_LAUNCHER="$INSTALL_DIR/launcher-universal.sh"
UNINSTALLER="$INSTALL_DIR/uninstall.sh"

# ---------- ุงููุฑุญูุฉ 1: ุงูุชุซุจูุช ุงูุฃุณุงุณู ----------
echo "๐ฅ ุชุญููู ุงูุจุฑูุงูุฌ..."
mkdir -p "$INSTALL_DIR"
cd "$INSTALL_DIR"

# ุชุญููู ุงููููุงุช ุงูุฃุณุงุณูุฉ
ESSENTIAL_FILES=(
    "$MAIN_SCRIPT"
    "azkar.txt"
    "adhan.ogg"
    "short_adhan.ogg"
    "prayer_approaching.ogg"
    "gt-tray.py"
)

for file in "${ESSENTIAL_FILES[@]}"; do
    echo "  โฌ๏ธ  ุชุญููู: $file"
    curl -fsSL "$REPO_BASE/$file" -o "$file" 2>/dev/null || echo "  โ๏ธ  ูู ูุชู ุชุญููู $file"
done

# ุชุญููู ููู ุฅูุบุงุก ุงูุชุซุจูุช
echo "  โฌ๏ธ  ุชุญููู: uninstall.sh"
curl -fsSL "https://raw.githubusercontent.com/SalehGNUTUX/GT-salat-dikr/main/uninstall.sh" -o "$UNINSTALLER" 2>/dev/null && {
    chmod +x "$UNINSTALLER"
    echo "  โ ุชู ุชุญููู ููู ุฅูุบุงุก ุงูุชุซุจูุช"
} || echo "  โ๏ธ  ูู ูุชู ุชุญููู uninstall.sh"

chmod +x "$MAIN_SCRIPT" "gt-tray.py" 2>/dev/null || true

# ---------- ุงููุฑุญูุฉ 2: ุชุญููู ุงูุฃููููุงุช ----------
echo ""
echo "๐ผ๏ธ  ุชุญููู ุงูุฃููููุงุช..."

ICON_DIR="$INSTALL_DIR/icons"
mkdir -p "$ICON_DIR"

echo "โฌ๏ธ  ุฌุงุฑู ุชุญููู ุงูุฃููููุงุช..."
for size in 16 32 48 64 128 256; do
    icon_url="$REPO_BASE/icons/prayer-icon-${size}.png"
    icon_file="$ICON_DIR/prayer-icon-${size}.png"
    
    if curl -fsSL "$icon_url" -o "$icon_file" 2>/dev/null; then
        echo "  โ ุชู ุชุญููู ุฃููููุฉ ${size}x${size}"
    fi
done

# ---------- ุงููุฑุญูุฉ 3: ุฅุถุงูุฉ ุนุฑุถ ุงูุฐูุฑ ูุงูุตูุงุฉ ูู ุงูุทุฑููุฉ ----------
echo ""
echo "๐ง ุฅุถุงูุฉ ุนุฑุถ ุงูุฐูุฑ ูุงูุตูุงุฉ ุนูุฏ ูุชุญ ุงูุทุฑููุฉ..."

# ุฅูุดุงุก script ุจุณูุท ูุนุฑุถ ุงูุฐูุฑ ูุงูุตูุงุฉ
cat > "$INSTALL_DIR/show-prayer.sh" << 'EOF'
#!/bin/bash
#
# ุนุฑุถ ุฐูุฑ ูููุนุฏ ุงูุตูุงุฉ ุนูุฏ ูุชุญ ุงูุทุฑููุฉ
#

INSTALL_DIR="$HOME/.GT-salat-dikr"
MAIN_SCRIPT="$INSTALL_DIR/gt-salat-dikr.sh"

if [ -f "$MAIN_SCRIPT" ]; then
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ            ๐ GT-salat-dikr ๐             โ"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค"
    
    # ุนุฑุถ ุฐูุฑ ุนุดูุงุฆู
    if [ -f "$INSTALL_DIR/azkar.txt" ]; then
        random_line=$((RANDOM % $(wc -l < "$INSTALL_DIR/azkar.txt") + 1))
        azkar=$(sed -n "${random_line}p" "$INSTALL_DIR/azkar.txt")
        echo "โ  ๏ทฝ $azkar"
        echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค"
    fi
    
    # ุนุฑุถ ููุนุฏ ุงูุตูุงุฉ ุงููุงุฏูุฉ
    if command -v gtsalat >/dev/null 2>&1; then
        prayer_info=$(gtsalat --next-prayer 2>/dev/null || echo "โ  ุฌุงุฑู ุชุญููู ููุงููุช ุงูุตูุงุฉ...")
        echo "โ  $prayer_info"
    else
        echo "โ  ูุจุฏุก ุงูุงุณุชุฎุฏุงู: gtsalat"
    fi
    
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
fi
EOF

chmod +x "$INSTALL_DIR/show-prayer.sh"

# ุฅุถุงูุฉ ุฅูู .bashrc ููุนูู ุชููุงุฆูุงู ุนูุฏ ูุชุญ terminal
if ! grep -q "show-prayer" "$HOME/.bashrc"; then
    echo "" >> "$HOME/.bashrc"
    echo "# ุนุฑุถ ุฐูุฑ ูููุนุฏ ุงูุตูุงุฉ ุนูุฏ ูุชุญ ุงูุทุฑููุฉ" >> "$HOME/.bashrc"
    echo "if [ -f \"$INSTALL_DIR/show-prayer.sh\" ]; then" >> "$HOME/.bashrc"
    echo "    . \"$INSTALL_DIR/show-prayer.sh\"" >> "$HOME/.bashrc"
    echo "fi" >> "$HOME/.bashrc"
    echo "  โ ุชู ุฅุถุงูุฉ ุนุฑุถ ุงูุฐูุฑ ุชููุงุฆูุงู ุนูุฏ ูุชุญ ุงูุทุฑููุฉ"
fi

# ---------- ุงููุฑุญูุฉ 4: ุฅูุดุงุก Launcher ูุญุณูู ----------
echo ""
echo "๐ง ุฅูุดุงุก ููุดุบูู ุฐูู..."

# ุชุจุณูุท ุงูู launcher ูุฌุนูู ูุนูู ุจุดูู ูุจุงุดุฑ
cat > "$LAUNCHER_FILE" << 'EOF'
#!/bin/bash
#
# GT-salat-dikr Launcher - ุงููุณุฎุฉ ุงููุจุณุทุฉ
# ูุนูู ูุจุงุดุฑุฉ ุจุฏูู ุชุนููุฏุงุช
#

INSTALL_DIR="$(dirname "$(realpath "$0")")"
TRAY_SCRIPT="$INSTALL_DIR/gt-tray.py"

# ุฃููุงู ูููุงุฌูุฉ
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

clear
echo -e "${BLUE}"
cat << "LOGO"
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ        ๐ GT-salat-dikr ๐             โ
โ     ูุธุงู ุฅุดุนุงุฑุงุช ุงูุตูุงุฉ ูุงูุฃุฐูุงุฑ       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
LOGO
echo -e "${NC}"

echo -e "${BLUE}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${GREEN}           ุฌุงุฑู ุชุดุบูู ุงููุธุงู...${NC}"
echo -e "${BLUE}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""

# ุงูุชุญูู ูู Python ูููุชุจุงุชู
echo -e "${YELLOW}๐ ุงูุชุญูู ูู ูุชุทูุจุงุช ุงููุธุงู...${NC}"
if ! command -v python3 >/dev/null 2>&1; then
    echo -e "${RED}โ Python3 ุบูุฑ ูุซุจุช${NC}"
    echo "ุณูุชู ุชุดุบูู ุงูุจุฑูุงูุฌ ุจุฏูู System Tray"
    sleep 3
else
    # ูุญุงููุฉ ุชุดุบูู System Tray
    echo -e "${GREEN}โ Python3 ูุซุจุช${NC}"
    
    # ุงูุชุญูู ูู ุงูููุชุจุงุช
    if python3 -c "import pystray, PIL" 2>/dev/null; then
        echo -e "${GREEN}โ ููุชุจุงุช Python ุฌุงูุฒุฉ${NC}"
        
        echo -e "${YELLOW}๐ ุฌุงุฑู ุชุดุบูู System Tray...${NC}"
        echo -e "${BLUE}โณ ุงูุฑุฌุงุก ุงูุงูุชุธุงุฑ 5 ุซูุงูู...${NC}"
        
        # ุชุดุบูู System Tray ูู ุงูุฎูููุฉ
        cd "$INSTALL_DIR"
        python3 "$TRAY_SCRIPT" >/dev/null 2>&1 &
        
        # ุนุฑุถ ูุคุดุฑ ุชูุฏู
        echo -n "${GREEN}"
        for i in {1..5}; do
            echo -n "โ"
            sleep 1
        done
        echo -e "${NC}"
        
        echo ""
        echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
        echo -e "${GREEN}โ ุชู ุงูุชุดุบูู ุจูุฌุงุญ!${NC}"
        echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
        echo ""
        echo -e "${YELLOW}๐ ูุงุฐุง ููููู ุฃู ุชูุนู ุงูุขู:${NC}"
        echo -e "1. ๐ ุงุจุญุซ ุนู ุฃููููุฉ GT-salat-dikr ูู ุดุฑูุท ุงูููุงู"
        echo -e "2. ๐ฑ๏ธ  ุงููุฑ ุจุฒุฑ ุงููุงูุณ ุงูุฃููู ุนูู ุงูุฃููููุฉ ููุชุญูู"
        echo -e "3. โ๏ธ  ุงุณุชุฎุฏู 'gtsalat' ูู ุงูุทุฑููุฉ ูููุฒูุฏ ูู ุงูุฎูุงุฑุงุช"
        echo ""
    else
        echo -e "${YELLOW}โ๏ธ  ููุชุจุงุช Python ุบูุฑ ูุซุจุชุฉ${NC}"
        echo "ุณูุชู ุชุดุบูู ุงูุจุฑูุงูุฌ ุจุฏูู System Tray"
    fi
fi

echo ""
echo -e "${BLUE}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${YELLOW}๐ก ุณุชูุบูู ูุฐู ุงููุงูุฐุฉ ุชููุงุฆูุงู ุฎูุงู 10 ุซูุงูู...${NC}"
echo -e "${BLUE}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"

sleep 10
exit 0
EOF

chmod +x "$LAUNCHER_FILE"

# ---------- ุงููุฑุญูุฉ 5: ุฅูุดุงุก Launcher ุนุงููู ูุชูุงูู ----------
echo ""
echo "๐ ุฅูุดุงุก Launcher ุนุงููู ูุชูุงูู..."

# ุชุจุณูุท ุงูู universal launcher
cat > "$UNIVERSAL_LAUNCHER" << 'EOF'
#!/bin/bash
#
# GT-salat-dikr Universal Launcher - ุงููุณุฎุฉ ุงููุจุณุทุฉ
# ูุนูู ูุจุงุดุฑุฉ ููุธูุฑ ุฑุณุงุฆู ูุงุถุญุฉ
#

INSTALL_DIR="$(dirname "$(realpath "$0")")"

# ุนุฑุถ ุฑุณุงูุฉ ุจุฏุงูุฉ
echo "๐ ุจุฏุก ุชุดุบูู GT-salat-dikr..."

# ูุญุงููุฉ ุงุณุชุฎุฏุงู ุงูู terminal ุงูููุงุณุจ
if command -v gnome-terminal >/dev/null 2>&1; then
    gnome-terminal -- bash -c "cd '$INSTALL_DIR' && ./launcher.sh; echo ''; echo 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ'; echo 'ุงููุงูุฐุฉ ุณุชูุบูู ุฎูุงู 10 ุซูุงูู...'; sleep 10"
elif command -v konsole >/dev/null 2>&1; then
    konsole -e bash -c "cd '$INSTALL_DIR' && ./launcher.sh; echo ''; echo 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ'; echo 'ุงุถุบุท Enter ููุฅุบูุงู...'; read"
elif command -v xterm >/dev/null 2>&1; then
    xterm -e bash -c "cd '$INSTALL_DIR' && ./launcher.sh; echo ''; echo 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ'; echo 'ุงููุงูุฐุฉ ุณุชูุบูู ุฎูุงู 10 ุซูุงูู...'; sleep 10"
elif command -v xfce4-terminal >/dev/null 2>&1; then
    xfce4-terminal -e bash -c "cd '$INSTALL_DIR' && ./launcher.sh; echo ''; echo 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ'; echo 'ุงุถุบุท Enter ููุฅุบูุงู...'; read"
else
    # ุฅุฐุง ูู ูุชู ุงูุนุซูุฑ ุนูู terminal ููุงุณุจุ ุงูุชุญ ูุจุงุดุฑุฉ
    cd "$INSTALL_DIR"
    ./launcher.sh
fi

exit 0
EOF

chmod +x "$UNIVERSAL_LAUNCHER"

# ---------- ุงููุฑุญูุฉ 6: ุฅูุดุงุก ููู .desktop ุจุณูุท ููุนุงู ----------
echo ""
echo "๐ฅ๏ธ  ุฅูุดุงุก ุฃููููุฉ ูู ูุงุฆูุฉ ุงูุจุฑุงูุฌ..."

# ุชุญุฏูุซ ููู .desktop ููููู ุจุณูุทุงู ููุนูู ูุจุงุดุฑุฉ
cat > "$DESKTOP_FILE" << EOF
[Desktop Entry]
Version=1.0
Type=Application
Name=GT-salat-dikr
GenericName=Prayer Times & Azkar
Comment=ูุธุงู ุฅุดุนุงุฑุงุช ุงูุตูุงุฉ ูุงูุฃุฐูุงุฑ ูุน System Tray
Exec=bash -c "cd '$INSTALL_DIR' && ./launcher-universal.sh"
Icon=$INSTALL_DIR/icons/prayer-icon-64.png
Terminal=false
Categories=Utility;Education;
Keywords=prayer;islam;azkar;reminder;ุตูุงุฉ;ุฃุฐูุงุฑ;ุฅุณูุงู;ุชุฐููุฑ;
EOF

# ูุณุฎ ููู .desktop ูููุงูุน ูุชุนุฏุฏุฉ
echo "๐ ูุณุฎ ุฃููููุฉ ุงูุจุฑูุงูุฌ..."

DESKTOP_LOCATIONS=(
    "$HOME/.local/share/applications/gt-salat-dikr.desktop"
    "$HOME/Desktop/gt-salat-dikr.desktop"
)

for location in "${DESKTOP_LOCATIONS[@]}"; do
    mkdir -p "$(dirname "$location")"
    cp "$DESKTOP_FILE" "$location" 2>/dev/null && echo "  โ ุชู ุงููุณุฎ ุฅูู: $location"
done

# ุชุญุฏูุซ ูุงุนุฏุฉ ุจูุงูุงุช ุงูุชุทุจููุงุช
if command -v update-desktop-database >/dev/null 2>&1; then
    update-desktop-database ~/.local/share/applications/ 2>/dev/null && \
    echo "  โ ุชู ุชุญุฏูุซ ูุงุฆูุฉ ุงูุชุทุจููุงุช"
fi

# ---------- ุงููุฑุญูุฉ 7: ุฅูุดุงุก ุฑูุงุจุท ููุฃูุงูุฑ ----------
echo ""
echo "๐ ุฅูุดุงุก ุฑูุงุจุท ููุฃูุงูุฑ..."

mkdir -p "$HOME/.local/bin"

# ุฅูุดุงุก ุฑุงุจุท ููุฃูุฑ ุงูุฑุฆูุณู
if [ -f "$INSTALL_DIR/$MAIN_SCRIPT" ]; then
    ln -sf "$INSTALL_DIR/$MAIN_SCRIPT" "$HOME/.local/bin/gtsalat" 2>/dev/null && \
    echo "  โ gtsalat - ุชู ุฅูุดุงุก ุงูุฑุงุจุท"
    
    # ุฅูุดุงุก ููู bashrc ูุฅุถุงูุฉ gtsalat ุฅูู PATH
    if ! grep -q "gtsalat" "$HOME/.bashrc"; then
        echo "" >> "$HOME/.bashrc"
        echo "# ุฃูุฑ gtsalat ูู GT-salat-dikr" >> "$HOME/.bashrc"
        echo "alias gtsalat='bash $INSTALL_DIR/gt-salat-dikr.sh'" >> "$HOME/.bashrc"
    fi
fi

# ุฅูุดุงุก ุฑุงุจุท ููู launcher
if [ -f "$LAUNCHER_FILE" ]; then
    ln -sf "$LAUNCHER_FILE" "$HOME/.local/bin/gt-launcher" 2>/dev/null && \
    echo "  โ gt-launcher - ุชู ุฅูุดุงุก ุงูุฑุงุจุท"
fi

# ุฅุถุงูุฉ .local/bin ุฅูู PATH ุฅุฐุง ูู ููู ููุฌูุฏุงู
if [[ ":$PATH:" != *":$HOME/.local/bin:"* ]]; then
    echo 'export PATH="$HOME/.local/bin:$PATH"' >> "$HOME/.bashrc"
    echo 'export PATH="$HOME/.local/bin:$PATH"' >> "$HOME/.profile"
    export PATH="$HOME/.local/bin:$PATH"
    echo "  โ ุชู ุฅุถุงูุฉ $HOME/.local/bin ุฅูู PATH"
fi

# ---------- ุงููุฑุญูุฉ 8: ุชุซุจูุช ููุชุจุงุช Python ----------
echo ""
echo "๐ฆ ุชุซุจูุช ููุชุจุงุช Python ูู System Tray..."

install_python_deps() {
    echo "  ๐ ุฌุงุฑู ุงูุชุญูู ูู ูุชุทูุจุงุช Python..."
    
    # ุงูุชุญูู ูู Python3
    if ! command -v python3 >/dev/null 2>&1; then
        echo "  ๐ฆ ุฌุงุฑู ุชุซุจูุช Python3..."
        if command -v apt >/dev/null 2>&1; then
            sudo apt update && sudo apt install -y python3 python3-pip
        elif command -v pacman >/dev/null 2>&1; then
            sudo pacman -Sy --noconfirm python python-pip
        elif command -v dnf >/dev/null 2>&1; then
            sudo dnf install -y python3 python3-pip
        fi
    fi
    
    # ุชุซุจูุช ุงูููุชุจุงุช
    echo "  ๐ฆ ุฌุงุฑู ุชุซุจูุช ููุชุจุงุช Python..."
    python3 -m pip install --user pystray pillow 2>/dev/null || {
        # ูุญุงููุฉ ุจุงุณุชุฎุฏุงู apt ุฅุฐุง ูุดู pip
        if command -v apt >/dev/null 2>&1; then
            sudo apt install -y python3-pystray python3-pil 2>/dev/null || \
            echo "  โ๏ธ  ุชุนุฐุฑ ุชุซุจูุช ุงูููุชุจุงุช ุชููุงุฆูุงู"
        fi
    }
}

# ุณุคุงู ุงููุณุชุฎุฏู ุฅุฐุง ูุงู ูุฑูุฏ ุชุซุจูุช System Tray
echo ""
read -p "ูู ุชุฑูุฏ ุชุซุจูุช System Tray (ุฃููููุฉ ูู ุดุฑูุท ุงูููุงู)ุ [Y/n]: " install_tray
if [[ "$install_tray" != "n" && "$install_tray" != "N" ]]; then
    install_python_deps
    echo "  โ ุชู ุชุซุจูุช ููุชุจุงุช Python"
else
    echo "  โญ๏ธ  ุชู ุชุฎุทู ุชุซุจูุช System Tray"
fi

# ---------- ุงููุฑุญูุฉ 9: ุฅุนุฏุงุฏ ุงูุชุดุบูู ุงูุชููุงุฆู ----------
echo ""
echo "๐ง ุฅุนุฏุงุฏ ุงูุชุดุบูู ุงูุชููุงุฆู..."

mkdir -p "$HOME/.config/autostart"

# ุฅูุดุงุก ููู autostart ุจุณูุท
cat > "$HOME/.config/autostart/gt-salat-dikr.desktop" << EOF
[Desktop Entry]
Type=Application
Name=GT-salat-dikr
Comment=Start prayer notifications on login
Exec=bash -c 'sleep 20 && gtsalat --notify-start >/dev/null 2>&1'
Icon=$INSTALL_DIR/icons/prayer-icon-32.png
Hidden=false
X-GNOME-Autostart-enabled=true
Terminal=false
EOF

echo "  โ ุชู ุฅุนุฏุงุฏ ุงูุชุดุบูู ุงูุชููุงุฆู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู"

# ---------- ุงููุฑุญูุฉ 10: ุจุฏุก ุงูุฎุฏูุงุช ----------
echo ""
echo "๐ ุจุฏุก ุชุดุบูู ุงููุธุงู..."

# ุจุฏุก ุฅุดุนุงุฑุงุช ุงูุตูุงุฉ
echo "๐ ุจุฏุก ุฅุดุนุงุฑุงุช ุงูุตูุงุฉ..."
if [ -f "$INSTALL_DIR/$MAIN_SCRIPT" ]; then
    bash "$INSTALL_DIR/$MAIN_SCRIPT" --notify-start >/dev/null 2>&1 &
    echo "  โ ุชู ุจุฏุก ุฅุดุนุงุฑุงุช ุงูุตูุงุฉ"
fi

# ุจุฏุก System Tray ุฅุฐุง ุทูุจ ุงููุณุชุฎุฏู
if [[ "$install_tray" != "n" && "$install_tray" != "N" ]] && [ -f "$TRAY_SCRIPT" ]; then
    echo "๐ฅ๏ธ  ุจุฏุก System Tray..."
    bash -c "sleep 8 && python3 '$TRAY_SCRIPT' >/dev/null 2>&1 &" &
    echo "  โ ุชู ุจุฏุก System Tray"
fi

# ---------- ุงููุฑุญูุฉ 11: ุนุฑุถ ุฑุณุงูุฉ ุงููุฌุงุญ ----------
sleep 3
clear
show_header

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ ูุจุฑูู! ุชู ุชุซุจูุช GT-salat-dikr ุจูุฌุงุญ ๐"
echo ""
echo "โจ ุงููููุฒุงุช ุงููุญุณููุฉ ูู ูุฐุง ุงูุฅุตุฏุงุฑ:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ 1. ุนุฑุถ ุงูุฐูุฑ ูููุนุฏ ุงูุตูุงุฉ ุนูุฏ ูุชุญ ุฃู terminal ุฌุฏูุฏ"
echo "โ 2. ุฃููููุฉ ูู ูุงุฆูุฉ ุงูุจุฑุงูุฌ ุชุนูู ุนูู ุฌููุน ุจูุฆุงุช ุณุทุญ ุงูููุชุจ"
echo "โ 3. System Tray ูุธูุฑ ูู ุดุฑูุท ุงูููุงู (ุฅุฐุง ุชู ุชุซุจูุชู)"
echo "โ 4. ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ูุจู ูู ุตูุงุฉ ุจู 15 ุฏูููุฉ"
echo "โ 5. ุนุฑุถ ุฃุฐูุงุฑ ูู 10 ุฏูุงุฆู"
echo "โ 6. ุชุดุบูู ุชููุงุฆู ุนูุฏ ุจุฏุก ุงููุธุงู"
echo "โ 7. ุฃูุงูุฑ ุณููุฉ ุงูุงุณุชุฎุฏุงู"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ ููููุฉ ุงูุงุณุชุฎุฏุงู:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "1. ุงูุชุญ terminal ุฌุฏูุฏ โ ${GREEN}ุณุชุฑู ุงูุฐูุฑ ูููุนุฏ ุงูุตูุงุฉ ุชููุงุฆูุงู${NC}"
echo ""
echo "2. ุงูุชุจ ูู ุฃู terminal:"
echo "   ${GREEN}gtsalat${NC}                 โ ุนุฑุถ ุงูุฐูุฑ ูุงูููุงููุช"
echo "   ${GREEN}gtsalat --show-timetable${NC} โ ููุงููุช ุงูููู"
echo "   ${GREEN}gtsalat --settings${NC}      โ ุงูุฅุนุฏุงุฏุงุช"
echo "   ${GREEN}gtsalat --notify-stop${NC}   โ ุฅููุงู ุงูุฅุดุนุงุฑุงุช"
echo "   ${GREEN}gtsalat --notify-start${NC}  โ ุจุฏุก ุงูุฅุดุนุงุฑุงุช"
echo ""
echo "3. ุงูุชุญ ูุงุฆูุฉ ุงูุจุฑุงูุฌ โ ุงุจุญุซ ุนู 'GT-salat-dikr'"
echo "   ุงููุฑ ุนูู ุงูุฃููููุฉ ูุจุฏุก System Tray"
echo ""
echo "4. ุงุจุญุซ ุนู ุฃููููุฉ ๐ ูู ุดุฑูุท ุงูููุงู"
echo "   ุงููุฑ ุจุฒุฑ ุงููุงูุณ ุงูุฃููู ููุชุญูู"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ก ูุซุงู ููุง ุณุชุฑุงู ุนูุฏ ูุชุญ terminal ุฌุฏูุฏ:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ            ๐ GT-salat-dikr ๐             โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค"
echo "โ  ๏ทฝ ุณุจุญุงู ุงููู ูุจุญูุฏู ุณุจุญุงู ุงููู ุงูุนุธูู   โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค"
echo "โ  ุงูุตูุงุฉ ุงููุงุฏูุฉ: ุงูุนุตุฑ - 15:30             โ"
echo "โ  ุงูููุช ุงููุชุจูู: 2 ุณุงุนุฉ ู 15 ุฏูููุฉ         โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ ูุนูููุงุช ุงูุชุซุจูุช:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โข ุงูุจุฑูุงูุฌ: $INSTALL_DIR/"
echo "โข ุงูุฅุนุฏุงุฏุงุช: ~/.config/gt-salat-dikr/"
echo "โข ุงูุฃูุงูุฑ: gtsalat, gt-launcher"
echo "โข ุงูุฅุฒุงูุฉ: gtsalat --uninstall"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ ุงูุงุฎุชุจุงุฑ ุงูุณุฑูุน:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

# ุงุฎุชุจุงุฑ ุณุฑูุน
echo "ุฌุงุฑู ุงุฎุชุจุงุฑ ุงูุจุฑูุงูุฌ..."
if command -v gtsalat >/dev/null 2>&1; then
    echo "โ ุงูุฃูุฑ 'gtsalat' ุฌุงูุฒ ููุงุณุชุฎุฏุงู"
    echo ""
    echo "ุนุฑุถ ูุซุงู:"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    gtsalat 2>/dev/null || echo "ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช..."
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
else
    echo "โ๏ธ  ูู ูุชู ุฅูุดุงุก ุงูุฃูุฑ 'gtsalat'"
    echo "๐ก ุฌุฑุจ ุชุดุบูู: source ~/.bashrc"
fi

echo ""
echo "๐ฏ ููุงุญุธุฉ:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โข ุชู ุฅุตูุงุญ ูุดููุฉ ุนุฑุถ ุงูุฐูุฑ ูู ุงูุทุฑููุฉ"
echo "โข ุชู ุฅุตูุงุญ ูุดููุฉ ุฃููููุฉ ูุงุฆูุฉ ุงูุจุฑุงูุฌ"
echo "โข ุงููุธุงู ูุนูู ุงูุขู ุจุดูู ุตุญูุญ ูุน ุฌููุน ุงููุธุงุฆู"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ ุงูุฏุนู: https://github.com/SalehGNUTUX/GT-salat-dikr"
echo ""
echo "ูุน ุงูุณูุงูุฉ! ููููู ุงูุจุฏุก ูู ุงุณุชุฎุฏุงู ุงูุจุฑูุงูุฌ ุงูุขู. ๐"

# ุงุฎุชุจุงุฑ ููุงุฆู
echo ""
read -p "ูู ุชุฑูุฏ ุงุฎุชุจุงุฑ ุงูุจุฑูุงูุฌ ุงูุขูุ [Y/n]: " test_now
if [[ "$test_now" != "n" && "$test_now" != "N" ]]; then
    echo ""
    echo "๐ ุฌุงุฑู ุงูุงุฎุชุจุงุฑ..."
    
    # ุงุฎุชุจุงุฑ ุนุฑุถ ุงูุฐูุฑ
    echo "1. ุงุฎุชุจุงุฑ ุนุฑุถ ุงูุฐูุฑ ูู ุงูุทุฑููุฉ:"
    . "$INSTALL_DIR/show-prayer.sh"
    
    echo ""
    echo "2. ุงุฎุชุจุงุฑ ุฃููููุฉ ูุงุฆูุฉ ุงูุจุฑุงูุฌ:"
    echo "   ุงูุชุญ ูุงุฆูุฉ ุงูุจุฑุงูุฌ ูุงุจุญุซ ุนู 'GT-salat-dikr'"
    echo "   ุงููุฑ ุนูู ุงูุฃููููุฉ ูุชุฑู ุฑุณุงูุฉ ุงูุชุดุบูู"
    
    echo ""
    echo "3. ุงุฎุชุจุงุฑ ุงูุฃูุงูุฑ:"
    echo "   ุงูุชุญ terminal ุฌุฏูุฏ ูุงูุชุจ: gtsalat"
fi

echo ""
echo "๐ ุชู ุงูุชุซุจูุช ุจูุฌุงุญ!"
echo "๐ก ูุฏ ุชุญุชุงุฌ ุฅูู ุฅุนุงุฏุฉ ูุชุญ ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ ูุฑุคูุฉ ุงูุฐูุฑ ุชููุงุฆูุงู."

exit 0
