#!/bin/bash

# GT-salat-dikr - Ù†Ø¸Ø§Ù… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø­Ø³Ù‘Ù†
# Ø§Ù„Ø¥ØµØ¯Ø§Ø±: 2.0
# Ø§Ù„Ù…Ø·ÙˆØ±: Gnutux

# Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
SCRIPT_DIR="$HOME/.local/bin"
CONFIG_DIR="$HOME/.config/gtsalat"
DATA_DIR="$HOME/.local/share/gtsalat"
AZKAR_FILE="$DATA_DIR/azkar.txt"
CONFIG_FILE="$CONFIG_DIR/settings.conf"
PID_FILE="$CONFIG_DIR/notify.pid"

# Ø§Ù„Ø£Ù„ÙˆØ§Ù†
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
default_display() {
    clear
    echo -e "${CYAN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${CYAN}  GT-salat-dikr - Ù†Ø¸Ø§Ù… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø­Ø³Ù‘Ù†${NC}"
    echo -e "${CYAN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    
    # Ø¹Ø±Ø¶ Ø§Ù„Ø°ÙƒØ± Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
    show_random_zekr
    echo ""
    
    # Ø¹Ø±Ø¶ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©  
    show_next_prayer
    echo ""
    
    echo -e "${YELLOW}ðŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ø³ØªØ®Ø¯Ù… 'gtsalat --help' Ù„Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª${NC}"
}

# Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø°ÙƒØ± Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
show_random_zekr() {
    if [[ -f "$AZKAR_FILE" ]]; then
        local zekr=$(shuf -n 1 "$AZKAR_FILE")
        echo -e "${GREEN}ðŸ“¿ $zekr${NC}"
    else
        echo -e "${RED}âŒ Ù…Ù„Ù Ø§Ù„Ø£Ø°ÙƒØ§Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯${NC}"
    fi
}

# Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
show_next_prayer() {
    if [[ -f "$CONFIG_FILE" ]]; then
        source "$CONFIG_FILE"
        local current_time=$(date +%H:%M)
        local next_prayer=""
        local next_time=""
        
        # ÙƒÙˆØ¯ Ø­Ø³Ø§Ø¨ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© (Ù…Ø«Ø§Ù„ Ù…Ø¨Ø³Ø·)
        echo -e "${BLUE}ðŸ•Œ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: Ø§Ù„Ù…ØºØ±Ø¨ 18:30 (Ø¨Ø§Ù‚ÙŠ 02:15)${NC}"
    else
        echo -e "${RED}âŒ Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯${NC}"
    fi
}

# Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
show_help() {
    echo -e "${CYAN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${CYAN}  GT-salat-dikr - Ù†Ø¸Ø§Ù… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø­Ø³Ù‘Ù†${NC}"
    echo -e "${CYAN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    
    echo -e "${YELLOW}ðŸ“¦ Ø§Ù„ØªØ«Ø¨ÙŠØª ÙˆØ§Ù„Ø¥Ø²Ø§Ù„Ø©:${NC}"
    echo -e "  ${GREEN}--install${NC}           ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…Ø¹ autostart Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ"
    echo -e "  ${GREEN}--uninstall${NC}         Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„"
    echo ""
    
    echo -e "${YELLOW}âš™ï¸  Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:${NC}"
    echo -e "  ${GREEN}--settings${NC}          ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"
    echo ""
    
    echo -e "${YELLOW}ðŸ“Š Ø§Ù„Ø¹Ø±Ø¶:${NC}"
    echo -e "  ${GREEN}--show-timetable${NC}    Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ù„Ù„ÙŠÙˆÙ…"
    echo -e "  ${GREEN}--status${NC}            Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©"
    echo ""
    
    echo -e "${YELLOW}ðŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:${NC}"
    echo -e "  ${GREEN}--notify-start${NC}      Ø¨Ø¯Ø¡ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ©"
    echo -e "  ${GREEN}--notify-stop${NC}       Ø¥ÙŠÙ‚Ø§Ù Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ©"
    echo ""
    
    echo -e "${YELLOW}ðŸ§ª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:${NC}"
    echo -e "  ${GREEN}--test-notify${NC}       Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©"
    echo -e "  ${GREEN}--test-adhan${NC}        Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø´ØºÙ„ Ø§Ù„Ø£Ø°Ø§Ù† Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠ"
    echo ""
    
    echo -e "${YELLOW}ðŸ”„ Ø§Ù„ØªØ­Ø¯ÙŠØ«:${NC}"
    echo -e "  ${GREEN}--update-azkar${NC}      ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù Ø§Ù„Ø£Ø°ÙƒØ§Ø±"
    echo -e "  ${GREEN}--self-update${NC}       ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬"
    echo ""
    
    echo -e "${YELLOW}â„¹ï¸  Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©:${NC}"
    echo -e "  ${GREEN}--help, -h${NC}          Ø¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©"
    echo ""
}

# Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª
install_script() {
    echo -e "${CYAN}ðŸš€ Ø¨Ø¯Ø¡ ØªØ«Ø¨ÙŠØª GT-salat-dikr...${NC}"
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
    mkdir -p "$SCRIPT_DIR" "$CONFIG_DIR" "$DATA_DIR"
    
    # Ù†Ø³Ø® Ø§Ù„Ø³ÙƒØ±Ø¨Øª
    cp "$0" "$SCRIPT_DIR/gtsalat"
    chmod +x "$SCRIPT_DIR/gtsalat"
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    if [[ ! -f "$AZKAR_FILE" ]]; then
        cat > "$AZKAR_FILE" << 'EOL'
Ø³ÙØ¨Ù’Ø­ÙŽØ§Ù†ÙŽ Ø§Ù„Ù„ÙŽÙ‘Ù‡Ù ÙˆÙŽØ¨ÙØ­ÙŽÙ…Ù’Ø¯ÙÙ‡Ù
Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙÙ…ÙŽÙ‘ ØµÙŽÙ„ÙÙ‘ Ø¹ÙŽÙ„ÙŽÙ‰ Ù…ÙØ­ÙŽÙ…ÙŽÙ‘Ø¯Ù ÙˆÙŽØ¹ÙŽÙ„ÙŽÙ‰ Ø¢Ù„Ù Ù…ÙØ­ÙŽÙ…ÙŽÙ‘Ø¯Ù
Ù„Ø§ÙŽ Ø­ÙŽÙˆÙ’Ù„ÙŽ ÙˆÙŽÙ„Ø§ÙŽ Ù‚ÙÙˆÙŽÙ‘Ø©ÙŽ Ø¥ÙÙ„Ø§ÙŽÙ‘ Ø¨ÙØ§Ù„Ù„ÙŽÙ‘Ù‡Ù
Ø£ÙŽØ³Ù’ØªÙŽØºÙ’ÙÙØ±Ù Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙŽ Ø§Ù„Ù’Ø¹ÙŽØ¸ÙÙŠÙ…ÙŽ
EOL
    fi
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    if [[ ! -f "$CONFIG_FILE" ]]; then
        cat > "$CONFIG_FILE" << 'EOL'
CITY="Ù…ÙƒØ©"
COUNTRY="Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©"
METHOD="Ù…ÙƒØ©"
LANGUAGE="ar"
EOL
    fi
    
    echo -e "${GREEN}âœ… ØªÙ… Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¨Ù†Ø¬Ø§Ø­!${NC}"
    echo -e "${YELLOW}ðŸ’¡ Ø§Ø³ØªØ®Ø¯Ù…: gtsalat --help Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª${NC}"
}

# Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø²Ø§Ù„Ø©
uninstall_script() {
    echo -e "${YELLOW}âš ï¸  Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ØŸ (y/n)${NC}"
    read -r response
    if [[ "$response" =~ ^[Yy]$ ]]; then
        rm -rf "$CONFIG_DIR" "$DATA_DIR"
        rm -f "$SCRIPT_DIR/gtsalat"
        echo -e "${GREEN}âœ… ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­${NC}"
    else
        echo -e "${BLUE}âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø²Ø§Ù„Ø©${NC}"
    fi
}

# Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
show_timetable() {
    echo -e "${CYAN}â° Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ù„Ù„ÙŠÙˆÙ…:${NC}"
    echo -e "${GREEN}Ø§Ù„ÙØ¬Ø±: 5:30${NC}"
    echo -e "${GREEN}Ø§Ù„Ø´Ø±ÙˆÙ‚: 6:45${NC}"
    echo -e "${GREEN}Ø§Ù„Ø¸Ù‡Ø±: 12:30${NC}"
    echo -e "${GREEN}Ø§Ù„Ø¹ØµØ±: 15:45${NC}"
    echo -e "${GREEN}Ø§Ù„Ù…ØºØ±Ø¨: 18:20${NC}"
    echo -e "${GREEN}Ø§Ù„Ø¹Ø´Ø§Ø¡: 19:45${NC}"
}

# Ø¯Ø§Ù„Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
notify_start() {
    echo -e "${GREEN}âœ… Ø¨Ø¯Ø¡ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø£Ø°ÙƒØ§Ø±...${NC}"
    # ÙƒÙˆØ¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
    echo -e "${YELLOW}ðŸ“ Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹${NC}"
}

# Ø¯Ø§Ù„Ø© Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
notify_stop() {
    echo -e "${RED}â¹ï¸  Ø¥ÙŠÙ‚Ø§Ù Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø£Ø°ÙƒØ§Ø±...${NC}"
    # ÙƒÙˆØ¯ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    echo -e "${GREEN}âœ… ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª${NC}"
}

# Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø©
show_status() {
    echo -e "${CYAN}ðŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:${NC}"
    echo -e "${GREEN}âœ… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…Ø«Ø¨Øª${NC}"
    echo -e "${GREEN}âœ… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ø§Ù‡Ø²Ø©${NC}"
    echo -e "${GREEN}âœ… Ù…Ù„Ù Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ù…ÙˆØ¬ÙˆØ¯${NC}"
    echo -e "${YELLOW}ðŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: ØºÙŠØ± Ù†Ø´Ø·Ø©${NC}"
}

# Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
main() {
    # Ø¨Ø¯ÙˆÙ† Ø®ÙŠØ§Ø±Ø§Øª: Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    if [ $# -eq 0 ]; then
        default_display
        exit 0
    fi

    # Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
    case "$1" in
        "--install")
            install_script
            ;;
        "--uninstall")
            uninstall_script
            ;;
        "--settings")
            echo -e "${CYAN}âš™ï¸  ÙØªØ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹...${NC}"
            ;;
        "--show-timetable")
            show_timetable
            ;;
        "--status")
            show_status
            ;;
        "--notify-start")
            notify_start
            ;;
        "--notify-stop")
            notify_stop
            ;;
        "--test-notify")
            echo -e "${GREEN}ðŸ”” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª...${NC}"
            ;;
        "--test-adhan")
            echo -e "${GREEN}ðŸ•Œ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø°Ø§Ù†...${NC}"
            ;;
        "--update-azkar")
            echo -e "${CYAN}ðŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø°ÙƒØ§Ø±...${NC}"
            ;;
        "--self-update")
            echo -e "${CYAN}ðŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬...${NC}"
            ;;
        "--help"|"-h")
            show_help
            ;;
        *)
            echo -e "${RED}âŒ Ø®ÙŠØ§Ø± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ: $1${NC}"
            echo ""
            show_help
            exit 1
            ;;
    esac
}

# Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
main "$@"
