#!/bin/bash
#
# ุณูุฑุจุช ูุญุต ุงูุฃุฎุทุงุก ูู gt-salat-dikr.sh
#

SCRIPT_FILE="$HOME/.GT-salat-dikr/gt-salat-dikr.sh"

echo "๐ ูุญุต ุฃุฎุทุงุก ุงูุจูุงุก ูู ุงูุณูุฑุจุช..."
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

if [ ! -f "$SCRIPT_FILE" ]; then
    echo "โ ุงูููู ุบูุฑ ููุฌูุฏ: $SCRIPT_FILE"
    exit 1
fi

# ูุญุต ุตุญุฉ ุงูุจูุงุก
if bash -n "$SCRIPT_FILE" 2>&1; then
    echo "โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ุจูุงุก"
    echo ""
    
    # ุงุฎุชุจุงุฑุงุช ุฅุถุงููุฉ
    echo "๐งช ุงุฎุชุจุงุฑุงุช ุฅุถุงููุฉ:"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    
    # ูุญุต ุงุณุชุฎุฏุงู local ุฎุงุฑุฌ ุงูุฏูุงู
    if grep -n "^[[:space:]]*local " "$SCRIPT_FILE" | grep -v "^[[:space:]]*#"; then
        echo "โ๏ธ  ุชุญุฐูุฑ: ูุฌุฏุช 'local' ุฎุงุฑุฌ ุฏุงูุฉ (ูุฏ ุชุณุจุจ ุฎุทุฃ)"
    else
        echo "โ ูุง ุชูุฌุฏ ูุชุบูุฑุงุช local ุฎุงุฑุฌ ุงูุฏูุงู"
    fi
    
    # ูุญุต ุงูุฃููุงุณ ุงููุชุทุงุจูุฉ
    if_count=$(grep -c "^[[:space:]]*if " "$SCRIPT_FILE")
    fi_count=$(grep -c "^[[:space:]]*fi$" "$SCRIPT_FILE")
    echo "โ if: $if_count, fi: $fi_count"
    
    # ูุญุต case/esac
    case_count=$(grep -c "^[[:space:]]*case " "$SCRIPT_FILE")
    esac_count=$(grep -c "^[[:space:]]*esac" "$SCRIPT_FILE")
    echo "โ case: $case_count, esac: $esac_count"
    
    # ูุญุต ุงูุฏูุงู
    func_count=$(grep -c "^[[:space:]]*[a-zA-Z_][a-zA-Z0-9_]*() {" "$SCRIPT_FILE")
    echo "โ ุนุฏุฏ ุงูุฏูุงู: $func_count"
    
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ ุงูุณูุฑุจุช ุฌุงูุฒ ููุงุณุชุฎุฏุงู!"
    
else
    echo ""
    echo "โ ูุฌุฏุช ุฃุฎุทุงุก ูู ุงูุจูุงุก - ุฑุงุฌุน ุงูุฑุณุงุฆู ุฃุนูุงู"
    exit 1
fi
