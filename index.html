<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GT-salat-dikr - نظام إشعارات الصلاة والأذكار المتكامل</title>
    <meta name="description" content="برنامج متكامل لمواقيت الصلاة والأذكار يعمل على جميع توزيعات لينكس - مفتوح المصدر ومرخص تحت GPL">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2e7d32;
            --primary-dark: #1b5e20;
            --secondary: #f5f5f5;
            --text: #333;
            --text-light: #666;
            --accent: #8bc34a;
            --background: #fff;
            --card-bg: #f8f8f8;
            --code-bg: #f1f1f1;
            --shadow: rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --primary: #4caf50;
            --primary-dark: #3d8b40;
            --secondary: #2a2a2a;
            --text: #f0f0f0;
            --text-light: #b0b0b0;
            --accent: #689f38;
            --background: #1e1e1e;
            --card-bg: #2d2d2d;
            --code-bg: #252525;
            --shadow: rgba(0, 0, 0, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: var(--transition);
        }
        
        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding: 0;
            margin: 0;
        }
        
        /* تذييل الصفحة */
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 3rem 1rem;
            text-align: center;
            position: relative;
        }
        
        header h1 {
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
        }
        
        header p {
            font-size: 1.3rem;
            max-width: 900px;
            margin: 0 auto;
            opacity: 0.9;
        }
        
        .theme-toggle {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        section {
            margin-bottom: 4rem;
        }
        
        h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--accent);
            font-size: 2rem;
        }
        
        h3 {
            color: var(--primary);
            margin: 1.5rem 0 1rem;
            font-size: 1.4rem;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .feature-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 6px 12px var(--shadow);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            border-right: 4px solid var(--primary);
        }
        
        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 20px var(--shadow);
        }
        
        .feature-card h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
        }
        
        .feature-card h3 i {
            font-size: 1.6rem;
        }
        
        .code-block {
            background-color: var(--code-bg);
            border-radius: 8px;
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            direction: ltr;
            text-align: left;
            font-family: 'Courier New', monospace;
            color: var(--text);
            border-right: 5px solid var(--primary);
            font-size: 1rem;
            line-height: 1.5;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background-color: var(--primary);
            color: white;
            padding: 1rem 2rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            margin: 0.5rem 0.5rem 0.5rem 0;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: var(--accent);
            color: var(--text);
        }
        
        .btn-secondary:hover {
            background-color: #7cb342;
        }
        
        footer {
            background-color: var(--secondary);
            text-align: center;
            padding: 3rem 1rem;
            margin-top: 4rem;
            color: var(--text);
        }
        
        .screenshot {
            width: 100%;
            max-width: 900px;
            margin: 1.5rem auto;
            display: block;
            border-radius: 10px;
            box-shadow: 0 6px 15px var(--shadow);
            border: 2px solid var(--accent);
        }
        
        .logo {
            font-size: 4rem;
            color: white;
            margin-bottom: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .commands {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .command-item {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            border-right: 4px solid var(--primary);
            transition: transform 0.2s;
        }
        
        .command-item:hover {
            transform: translateX(5px);
        }
        
        .command-item code {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1rem;
            background: var(--code-bg);
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
        }
        
        .highlight {
            background: linear-gradient(120deg, var(--accent) 0%, var(--accent) 100%);
            background-repeat: no-repeat;
            background-size: 100% 0.4em;
            background-position: 0 88%;
            font-weight: bold;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 1.5rem;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 8px var(--shadow);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .demo-terminal {
            background: #1e1e1e;
            color: #00ff00;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
            font-family: 'Courier New', monospace;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
        
        .demo-line {
            margin-bottom: 0.5rem;
        }
        
        .demo-prompt {
            color: #ffff00;
        }
        
        .demo-output {
            color: #00ffff;
        }
        
        .demo-highlight {
            color: #ff6b6b;
            font-weight: bold;
        }

        /* أنماط جديدة للعرض الحي */
        .live-prayer-widget {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            border: 2px solid var(--primary);
            text-align: center;
        }

        .prayer-info {
            font-size: 1.2rem;
            margin: 1rem 0;
        }

        .next-prayer {
            color: var(--primary);
            font-weight: bold;
            font-size: 1.4rem;
            margin: 1rem 0;
        }

        .location-info {
            color: var(--text-light);
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .loading {
            color: var(--text-light);
            font-style: italic;
        }

        .error {
            color: #ff6b6b;
            font-weight: bold;
        }

        .refresh-btn {
            background: var(--accent);
            color: var(--text);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            margin: 1rem 0;
            font-weight: bold;
            font-size: 1rem;
        }

        .refresh-btn:hover {
            background: #7cb342;
        }

        .prayer-times-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .prayer-time-item {
            background: var(--background);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--accent);
        }

        .prayer-time-item.next {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .prayer-name {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .prayer-time {
            font-size: 1.2rem;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2.2rem;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .commands {
                grid-template-columns: 1fr;
            }
            
            .theme-toggle {
                top: 0.5rem;
                left: 0.5rem;
                width: 40px;
                height: 40px;
            }
            
            .btn {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }

            .prayer-times-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <header>
        <button class="theme-toggle" id="themeToggle">
            <i class="fas fa-moon"></i>
        </button>
        <div class="logo">
            <i class="fas fa-mosque"></i>
        </div>
        <h1>GT-salat-dikr 🕌</h1>
        <p>نظام إشعارات الصلاة والأذكار المتكامل - يعمل على جميع توزيعات لينكس</p>
        <p>مفتوح المصدر ⚡ مرخص تحت GPL 📜</p>
    </header>
    
    <div class="container">
        <section id="intro">
            <h2><i class="fas fa-info-circle"></i> نظام متكامل لتذكير الصلاة والأذكار</h2>
            <p>GT-salat-dikr هو نظام متكامل يجمع بين دقة مواقيت الصلاة وقوة التذكير المستمر للأذكار. مصمم خصيصًا لمستخدمي لينكس الذين يبحثون عن حل تقني متكامل يساعدهم على الالتزام بالعبادات اليومية.</p>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number">80+</div>
                    <div>ذكر متنوع</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">22</div>
                    <div>طريقة حساب</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">15+</div>
                    <div>بيئة مدعومة</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">100%</div>
                    <div>مفتوح المصدر</div>
                </div>
            </div>

            <!-- عرض الصلاة الحي -->
            <div class="live-prayer-widget">
                <h3><i class="fas fa-clock"></i> مواقيت الصلاة الحية</h3>
                <div class="location-info" id="locationInfo">جاري اكتشاف موقعك...</div>
                <div id="prayerWidget">
                    <div class="loading">جاري تحميل مواقيت الصلاة...</div>
                </div>
                <button class="refresh-btn" onclick="loadPrayerTimes()">
                    <i class="fas fa-sync-alt"></i> تحديث المواقيت
                </button>
            </div>
            
            <div class="demo-terminal">
                <div class="demo-line"><span class="demo-prompt">$</span> <span class="demo-output">gtsalat</span></div>
                <div class="demo-line">سُبْحَانَ اللَّهِ وَبِحَمْدِهِ، سُبْحَانَ اللَّهِ الْعَظِيمِ</div>
                <div class="demo-line"></div>
                <div class="demo-line"><span class="demo-highlight">🕌 الصلاة القادمة: العصر عند 15:30 (باقي 02:15)</span></div>
            </div>
            
            <a href="https://github.com/SalehGNUTUX/GT-salat-dikr" class="btn">
                <i class="fab fa-github"></i> استعراض الكود المصدري
            </a>
            <a href="#installation" class="btn btn-secondary">
                <i class="fas fa-download"></i> التثبيت الفوري
            </a>
        </section>
        
        <section id="features">
            <h2><i class="fas fa-star"></i> الميزات المتقدمة</h2>
            <div class="features">
                <div class="feature-card">
                    <h3><i class="fas fa-book-quran"></i> أذكار شاملة ومتنوعة</h3>
                    <p>قاعدة بيانات شاملة تحتوي على أكثر من 80 ذكر متنوع من الأذكار الإسلامية الموثوقة، مع تحديث تلقائي من المصادر المعتمدة.</p>
                </div>
                
                <div class="feature-card">
                    <h3><i class="fas fa-clock"></i> مواقيت صلاة دقيقة</h3>
                    <p>حساب تلقائي لمواقيت الصلاة بدقة عالية بناءً على موقعك الجغرافي، مع دعم 22 طريقة حساب مختلفة من جميع أنحاء العالم الإسلامي.</p>
                </div>
                
                <div class="feature-card">
                    <h3><i class="fas fa-bell"></i> إشعارات ذكية</h3>
                    <p>إشعارات تلقائية للأذكار على فترات زمنية قابلة للتخصيص، تنبيه قبل الصلاة بـ10 دقائق، وإشعارات دخول وقت الصلاة مع تشغيل الأذان.</p>
                </div>
                
                <div class="feature-card">
                    <h3><i class="fas fa-desktop"></i> دعم جميع واجهات سطح المكتب</h3>
                    <p>توافق كامل مع GNOME, KDE, XFCE, i3, Sway, Awesome WM, Openbox, LXDE وجميع بيئات سطح المكتب الأخرى.</p>
                </div>
                
                <div class="feature-card">
                    <h3><i class="fas fa-terminal"></i> دعم جميع أنواع الطرفيات</h3>
                    <p>عمل متكامل مع Bash, Zsh, Fish, Ksh, Tcsh وجميع أنواع الشل، مع إعداد تلقائي لكل منها.</p>
                </div>
                
                <div class="feature-card">
                    <h3><i class="fas fa-sync-alt"></i> تحديث تلقائي</h3>
                    <p>تحديث تلقائي للبرنامج والأذكار، مع خيار التحديث اليدوي والحفاظ على الإعدادات الشخصية.</p>
                </div>
            </div>
        </section>
        
        <section id="installation">
            <h2><i class="fas fa-download"></i> التثبيت السريع</h2>
            
            <h3><i class="fas fa-bolt"></i> التثبيت التلقائي (مستحسن)</h3>
            <p>نسخة واحدة تشمل كل شيء - التثبيت، الإعدادات، البدء التلقائي:</p>
            <div class="code-block">
bash -c "$(curl -fsSL https://raw.githubusercontent.com/SalehGNUTUX/GT-salat-dikr/main/install.sh)"
            </div>
            
            <h3><i class="fas fa-cogs"></i> التثبيت اليدوي للمستخدمين المتقدمين</h3>
            <div class="code-block">
git clone https://github.com/SalehGNUTUX/GT-salat-dikr.git<br>cd GT-salat-dikr<br>chmod +x install.sh<br>./install.sh
            </div>
            
            <h3><i class="fas fa-trash"></i> إزالة التثبيت</h3>
            <div class="code-block">
bash -c "$(curl -fsSL https://raw.githubusercontent.com/SalehGNUTUX/GT-salat-dikr/main/uninstall.sh)"
            </div>
        </section>
        
        <section id="usage">
            <h2><i class="fas fa-terminal"></i> الأوامر المتاحة</h2>
            
            <div class="commands">
                <div class="command-item">
                    <p><code>gtsalat</code> - التشغيل العادي (عرض ذكر ومعلومات الصلاة القادمة)</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --show-timetable</code> - عرض مواقيت الصلاة كاملة لليوم</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat -t</code> - اختصار لعرض مواقيت الصلاة</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --settings</code> - إعدادات الموقع وطريقة الحساب</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --notify-start</code> - تشغيل الإشعارات التلقائية</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --notify-stop</code> - إيقاف الإشعارات</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --test-notify</code> - اختبار الإشعارات</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --test-adhan</code> - اختبار تشغيل الأذان</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --update-azkar</code> - تحديث الأذكار من الإنترنت</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --self-update</code> - تحديث البرنامج نفسه</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --status</code> - عرض حالة البرنامج</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --logs</code> - عرض سجل التشغيل</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --debug</code> - معلومات التشخيص</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --help</code> - عرض المساعدة الكاملة</p>
                </div>
            </div>
        </section>
        
        <section id="screenshots">
            <h2><i class="fas fa-desktop"></i> أمثلة حية من البرنامج</h2>
            
            <h3>عرض الذكر وموعد الصلاة القادمة:</h3>
            <div class="code-block">
# عند فتح الطرفية تلقائيًا:<br>لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير<br><br>🕌 الصلاة القادمة: العصر عند 15:30 (باقي 02:15)
            </div>
            
            <h3>جدول المواقيت الكامل:</h3>
            <div class="code-block">
مواقيت الصلاة اليوم (الرياض):<br>      الفجر: 04:30<br>    الشروق: 05:45<br>      الظهر: 12:15<br>      العصر: 15:30  ← القادمة<br>     المغرب: 18:45<br>     العشاء: 20:00
            </div>
            
            <h3>حالة البرنامج المتقدمة:</h3>
            <div class="code-block">
📊 حالة GT-salat-dikr:<br>════════════════════════════════<br>✅ الإشعارات: تعمل (PID: 2543)<br><br>📍 الموقع: الرياض, السعودية<br>🧭 الإحداثيات: 24.7136, 46.6753<br>📖 طريقة الحساب: Umm Al-Qura University, Makkah<br><br>🕌 الصلاة القادمة: العصر<br>⏰ الوقت: 15:30<br>⏳ المتبقي: 02:15
            </div>
        </section>
        
        <section id="technical">
            <h2><i class="fas fa-cogs"></i> المعلومات التقنية</h2>
            
            <h3>المتطلبات الأساسية:</h3>
            <ul>
                <li>نظام لينكس (أي توزيعة)</li>
                <li>Bash 4.0 أو أحدث</li>
                <li>curl لتحميل الملفات</li>
                <li>jq لمعالجة JSON (اختياري لكن مستحسن)</li>
                <li>libnotify للإشعارات</li>
            </ul>
            
            <h3>الميزات التقنية:</h3>
            <ul>
                <li>دعم نظامي init: systemd و XDG autostart</li>
                <li>إدارة عمليات خلفية ذكية</li>
                <li>سجل أخطاء مفصل</li>
                <li>اكتشاف تلقائي للموقع الجغرافي</li>
                <li>واجهة رسومية للأذان (zenity/yad/kdialog)</li>
                <li>دعم مشغلات صوت متعددة (mpv, ffplay, paplay, ogg123)</li>
            </ul>
        </section>
        
        <section id="license">
            <h2><i class="fas fa-balance-scale"></i> الترخيص والمشاركة</h2>
            <p>هذا البرنامج مرخص تحت <span class="highlight">رخصة جنو العمومية (GPL v3)</span>. يمكنك:</p>
            <ul>
                <li>استخدام البرنامج مجانًا لأي غرض</li>
                <li>تعديل الشفرة المصدرية كما تشاء</li>
                <li>توزيع نسخ معدلة مع الإشارة إلى التغييرات</li>
                <li>المساهمة في تطوير المشروع</li>
            </ul>
            
            <p>المشروع مبني على فلسفة البرمجيات الحرة، ونرحب بجميع المساهمات والتطويرات.</p>
            
            <a href="https://github.com/SalehGNUTUX/GT-salat-dikr" class="btn">
                <i class="fas fa-code"></i> المساهمة في التطوير
            </a>
            <a href="https://github.com/SalehGNUTUX/GT-salat-dikr/issues" class="btn btn-secondary">
                <i class="fas fa-bug"></i> الإبلاغ عن مشكلة
            </a>
        </section>
    </div>
    
    <footer>
        <div class="container">
            <p>GT-salat-dikr - نظام إشعارات الصلاة والأذكار المتكامل</p>
            <p>تم التطوير بواسطة <a href="https://github.com/SalehGNUTUX">SalehGNUTUX</a> - مرخص تحت <a href="https://github.com/SalehGNUTUX/GT-salat-dikr/blob/main/LICENSE">GPL v3</a></p>
            <p>🌙 نسخة حديثة ومطورة - 2025</p>
        </div>
    </footer>

    <script>
        // تبديل الوضع المظلم
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('i');
        
        // التحقق من التفضيل المحفوظ
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
        }
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            
            if (currentTheme === 'dark') {
                document.documentElement.removeAttribute('data-theme');
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
                localStorage.setItem('theme', 'dark');
            }
        });
        
        // تأثيرات scroll suave
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({
                        behavior: 'smooth'
                    });
                }
            });
        });

        // بيانات الأذكار
const azkar = [
    "سُبْحَانَ اللَّهِ وَبِحَمْدِهِ، سُبْحَانَ اللَّهِ الْعَظِيمِ",
    "لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ",
    "اللَّهُمَّ صَلِّ عَلَى مُحَمَّدٍ وَعَلَى آلِ مُحَمَّدٍ",
    "أسْتَغْفِرُ اللَّهِ الْعَظِيمَ الَّذِي لَا إِلَهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ وَأَتُوبُ إِلَيْهِ",
    "حَسْبِيَ اللَّهُ لَا إِلَهَ إِلَّا هُوَ عَلَيْهِ تَوَكَّلْتُ وَهُوَ رَبُّ الْعَرْشِ الْعَظِيمِ",
    "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْهَمِّ وَالْحَزَنِ، وَالْعَجْزِ وَالْكَسَلِ، وَالْجُبْنِ وَالْبُخْلِ، وَضَلَعِ الدَّيْنِ وَغَلَبَةِ الرِّجَالِ",
    "اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا، وَرِزْقًا طَيِّبًا، وَعَمَلًا مُتَقَبَّلًا",
    "لَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِاللَّهِ الْعَلِيِّ الْعَظِيمِ",
    "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ عِلْمٍ لَا يَنْفَعُ، وَمِنْ قَلْبٍ لَا يَخْشَعُ، وَمِنْ نَفْسٍ لَا تَشْبَعُ، وَمِنْ دَعْوَةٍ لَا يُسْتَجَابُ لَهَا"
];

// الحصول على مواقيت الصلاة الحقيقية مع التوقيت المحلي الصحيح
async function loadPrayerTimes() {
    const prayerWidget = document.getElementById('prayerWidget');
    const locationInfo = document.getElementById('locationInfo');
    
    try {
        prayerWidget.innerHTML = '<div class="loading">🔄 جاري جلب مواقيت الصلاة...</div>';
        
        const position = await getCurrentPosition();
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        
        // الحصول على المنطقة الزمنية المحلية
        const timezone = await getLocalTimezone(lat, lon);
        const now = new Date();
        
        // تحويل التاريخ إلى التوقيت المحلي
        const localDate = new Date(now.toLocaleString("en-US", {timeZone: timezone}));
        const today = localDate.toISOString().split('T')[0];
        
        // استخدام API مع المنطقة الزمنية
        const apiUrl = `https://api.aladhan.com/v1/timings/${today}?latitude=${lat}&longitude=${lon}&method=4&timezonestring=${timezone}`;
        
        const response = await fetch(apiUrl);
        const data = await response.json();
        
        if (data.code === 200) {
            const timings = data.data.timings;
            const city = await getCityName(lat, lon);
            
            // تحويل المواقيت إلى التوقيت المحلي
            const localTimings = convertToLocalTime(timings, timezone);
            
            displayPrayerData(localTimings, city, timezone, '📍 (مباشر)');
            
        } else {
            throw new Error('Failed to fetch prayer times');
        }
        
    } catch (error) {
        console.log('Primary API failed, using fallback...', error);
        await useFallbackWithLocalTime();
    }
}

// الحصول على المنطقة الزمنية المحلية
async function getLocalTimezone(lat, lon) {
    try {
        // استخدام API مجاني للمنطقة الزمنية
        const response = await fetch(`https://api.ipgeolocation.io/timezone?apiKey=demo&lat=${lat}&long=${lon}`);
        if (response.ok) {
            const data = await response.json();
            return data.timezone;
        }
    } catch (error) {
        console.log('Timezone API failed, using browser timezone');
    }
    
    // استخدام المنطقة الزمنية للمتصفح كبديل
    return Intl.DateTimeFormat().resolvedOptions().timeZone;
}

// تحويل المواقيت إلى التوقيت المحلي
function convertToLocalTime(timings, timezone) {
    const localTimings = {};
    const now = new Date();
    const today = now.toISOString().split('T')[0];
    
    for (const [prayerName, prayerTime] of Object.entries(timings)) {
        if (['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'].includes(prayerName)) {
            // إنشاء تاريخ UTC من وقت الصلاة
            const [hours, minutes] = prayerTime.split(':');
            const utcDate = new Date(`${today}T${hours}:${minutes}:00Z`);
            
            // تحويل إلى التوقيت المحلي
            const localDate = new Date(utcDate.toLocaleString("en-US", {timeZone: timezone}));
            
            // تنسيق الوقت المحلي
            const localHours = localDate.getHours().toString().padStart(2, '0');
            const localMinutes = localDate.getMinutes().toString().padStart(2, '0');
            
            localTimings[prayerName] = `${localHours}:${localMinutes}`;
        } else {
            localTimings[prayerName] = prayerTime;
        }
    }
    
    return localTimings;
}

// البديل مع التوقيت المحلي
async function useFallbackWithLocalTime() {
    try {
        const position = await getCurrentPosition();
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        const timezone = await getLocalTimezone(lat, lon);
        const city = await getCityName(lat, lon);
        
        // حساب مواقيت محلية دقيقة
        const localTimings = calculateLocalPrayerTimes(lat, lon, timezone);
        displayPrayerData(localTimings, city, timezone, '📍 (حساب محلي)');
        
    } catch (error) {
        useSmartLocalDefaults();
    }
}

// حساب مواقيت محلية دقيقة
function calculateLocalPrayerTimes(lat, lon, timezone) {
    const now = new Date();
    const localDate = new Date(now.toLocaleString("en-US", {timeZone: timezone}));
    const dayOfYear = Math.floor((localDate - new Date(localDate.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
    
    // حسابات دقيقة تأخذ في الاعتبار الموقع والوقت من السنة
    const baseTime = {
        Fajr: 5.5,      // 5:30
        Sunrise: 7.0,   // 7:00
        Dhuhr: 13.0,    // 13:00
        Asr: 16.0,      // 16:00
        Maghrib: 19.0,  // 19:00
        Isha: 20.5      // 20:30
    };
    
    // تعديل حسب خط العرض والفصل
    const latAdjustment = (Math.abs(lat) - 30) * 0.08;
    const seasonAdjustment = Math.sin((dayOfYear - 80) * 0.0172) * 0.8;
    
    const adjustments = {
        Fajr: latAdjustment - seasonAdjustment,
        Sunrise: latAdjustment - seasonAdjustment,
        Dhuhr: 0,
        Asr: latAdjustment + seasonAdjustment * 0.5,
        Maghrib: latAdjustment + seasonAdjustment,
        Isha: latAdjustment + seasonAdjustment
    };
    
    const localTimings = {};
    for (const [prayer, base] of Object.entries(baseTime)) {
        const adjustedTime = base + adjustments[prayer];
        localTimings[prayer] = formatTime(adjustedTime);
    }
    
    return localTimings;
}

// بيانات افتراضية ذكية مع التوقيت المحلي
function useSmartLocalDefaults() {
    const locationInfo = document.getElementById('locationInfo');
    const prayerWidget = document.getElementById('prayerWidget');
    
    const now = new Date();
    const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
    const currentTime = now.getHours().toString().padStart(2, '0') + ':' + 
                       now.getMinutes().toString().padStart(2, '0');
    
    // بيانات ذكية حسب المنطقة الزمنية
    const localTimings = getSmartLocalTimings(timezone);
    
    locationInfo.textContent = `📍 موقعك الحالي - ${new Date().toLocaleDateString('ar-EG')} (${timezone})`;
    displayPrayerTimes(localTimings);
    displayRandomZekr();
    
    const alert = document.createElement('div');
    alert.className = 'prayer-info';
    alert.style.color = '#ffa500';
    alert.style.fontSize = '0.9rem';
    alert.innerHTML = '💡 <strong>ملاحظة:</strong> جاري استخدام توقيتات محلية ذكية. للتوقيتات الدقيقة، قم بتثبيت البرنامج.';
    prayerWidget.appendChild(alert);
}

// بيانات ذكية حسب المنطقة الزمنية
function getSmartLocalTimings(timezone) {
    const now = new Date();
    const utcOffset = getTimezoneOffset(timezone);
    const month = now.getMonth() + 1;
    
    // قاعدة توقيتات حسب المنطقة الزمنية
    const timezoneBases = {
        'Africa/Casablanca': { // المغرب (UTC+1)
            summer: { Fajr: "06:00", Sunrise: "07:25", Dhuhr: "13:20", Asr: "16:35", Maghrib: "19:08", Isha: "20:25" },
            winter: { Fajr: "06:30", Sunrise: "08:00", Dhuhr: "13:00", Asr: "16:00", Maghrib: "18:30", Isha: "19:45" }
        },
        'Asia/Riyadh': { // السعودية (UTC+3)
            summer: { Fajr: "04:00", Sunrise: "05:30", Dhuhr: "12:00", Asr: "15:15", Maghrib: "18:30", Isha: "20:00" },
            winter: { Fajr: "04:30", Sunrise: "06:00", Dhuhr: "11:45", Asr: "14:45", Maghrib: "17:45", Isha: "19:15" }
        },
        'Europe/London': { // بريطانيا (UTC+0/+1)
            summer: { Fajr: "03:00", Sunrise: "05:00", Dhuhr: "13:00", Asr: "17:00", Maghrib: "21:00", Isha: "22:00" },
            winter: { Fajr: "05:30", Sunrise: "07:30", Dhuhr: "12:00", Asr: "14:30", Maghrib: "16:30", Isha: "18:00" }
        }
    };
    
    const isSummer = month >= 4 && month <= 9;
    const base = timezoneBases[timezone] || timezoneBases['Africa/Casablanca']; // افتراضي المغرب
    
    return isSummer ? base.summer : base.winter;
}

// الحصول على إزاحة المنطقة الزمنية
function getTimezoneOffset(timezone) {
    const now = new Date();
    const utcDate = new Date(now.toLocaleString("en-US", {timeZone: "UTC"}));
    const tzDate = new Date(now.toLocaleString("en-US", {timeZone: timezone}));
    return (tzDate - utcDate) / (1000 * 60 * 60);
}

// عرض البيانات مع المعلومات الزمنية
function displayPrayerData(timings, city, timezone, source) {
    const locationInfo = document.getElementById('locationInfo');
    const now = new Date();
    const localDate = new Date(now.toLocaleString("en-US", {timeZone: timezone}));
    const currentTime = localDate.getHours().toString().padStart(2, '0') + ':' + 
                       localDate.getMinutes().toString().padStart(2, '0');
    
    const utcOffset = getTimezoneOffset(timezone);
    const offsetSign = utcOffset >= 0 ? '+' : '';
    
    locationInfo.textContent = `${source} ${city} - ${localDate.toLocaleDateString('ar-EG')} (UTC${offsetSign}${utcOffset})`;
    displayPrayerTimes(timings, currentTime);
    displayRandomZekr();
}

// عرض مواقيت الصلاة مع الوقت الحالي المحلي
function displayPrayerTimes(timings, currentTime = null) {
    if (!currentTime) {
        const now = new Date();
        currentTime = now.getHours().toString().padStart(2, '0') + ':' + 
                     now.getMinutes().toString().padStart(2, '0');
    }
    
    const prayerTimes = [
        { name: 'الفجر', time: timings.Fajr, key: 'Fajr' },
        { name: 'الشروق', time: timings.Sunrise, key: 'Sunrise' },
        { name: 'الظهر', time: timings.Dhuhr, key: 'Dhuhr' },
        { name: 'العصر', time: timings.Asr, key: 'Asr' },
        { name: 'المغرب', time: timings.Maghrib, key: 'Maghrib' },
        { name: 'العشاء', time: timings.Isha, key: 'Isha' }
    ];

    let nextPrayer = null;
    for (const prayer of prayerTimes) {
        if (prayer.time > currentTime) {
            nextPrayer = prayer;
            break;
        }
    }

    if (!nextPrayer) {
        nextPrayer = prayerTimes[0];
    }

    // حساب الوقت المتبقي
    const nextTime = nextPrayer.time.split(':');
    const nextDate = new Date();
    nextDate.setHours(parseInt(nextTime[0]), parseInt(nextTime[1]), 0, 0);
    
    let diffMs = nextDate - new Date();
    if (diffMs < 0) {
        diffMs += 24 * 60 * 60 * 1000;
    }
    
    const diffMins = Math.floor(diffMs / (1000 * 60));
    const hours = Math.floor(diffMins / 60);
    const minutes = diffMins % 60;

    let html = `
        <div class="next-prayer">
            🕌 الصلاة القادمة: ${nextPrayer.name} عند ${nextPrayer.time}
        </div>
        <div class="prayer-info">
            ⏳ المتبقي: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}
        </div>
        <div class="prayer-info" style="font-size: 0.9rem; color: var(--text-light);">
            🕒 التوقيت المحلي الحقيقي: ${currentTime}
        </div>
        <div class="prayer-times-grid">
    `;

    prayerTimes.forEach(prayer => {
        const isNext = prayer.name === nextPrayer.name;
        html += `
            <div class="prayer-time-item ${isNext ? 'next' : ''}">
                <div class="prayer-name">${prayer.name}</div>
                <div class="prayer-time">${prayer.time}</div>
            </div>
        `;
    });

    html += `</div>`;
    document.getElementById('prayerWidget').innerHTML = html;
}
    </script>
</body>
</html>
