<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GT-salat-dikr - نظام إشعارات الصلاة والأذكار المتكامل</title>
    <meta name="description" content="برنامج متكامل لمواقيت الصلاة والأذكار يعمل على جميع توزيعات لينكس - مفتوح المصدر ومرخص تحت GPL">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2e7d32;
            --primary-dark: #1b5e20;
            --secondary: #f5f5f5;
            --text: #333;
            --text-light: #666;
            --accent: #8bc34a;
            --background: #fff;
            --card-bg: #f8f8f8;
            --code-bg: #f1f1f1;
            --shadow: rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --primary: #4caf50;
            --primary-dark: #3d8b40;
            --secondary: #2a2a2a;
            --text: #f0f0f0;
            --text-light: #b0b0b0;
            --accent: #689f38;
            --background: #1e1e1e;
            --card-bg: #2d2d2d;
            --code-bg: #252525;
            --shadow: rgba(0, 0, 0, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: var(--transition);
        }
        
        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding: 0;
            margin: 0;
        }
        
        /* تذييل الصفحة */
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 3rem 1rem;
            text-align: center;
            position: relative;
        }
        
        header h1 {
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
        }
        
        header p {
            font-size: 1.3rem;
            max-width: 900px;
            margin: 0 auto;
            opacity: 0.9;
        }
        
        .theme-toggle {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        section {
            margin-bottom: 4rem;
        }
        
        h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--accent);
            font-size: 2rem;
        }
        
        h3 {
            color: var(--primary);
            margin: 1.5rem 0 1rem;
            font-size: 1.4rem;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .feature-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 6px 12px var(--shadow);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            border-right: 4px solid var(--primary);
        }
        
        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 20px var(--shadow);
        }
        
        .feature-card h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
        }
        
        .feature-card h3 i {
            font-size: 1.6rem;
        }
        
        .code-block {
            background-color: var(--code-bg);
            border-radius: 8px;
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            direction: ltr;
            text-align: left;
            font-family: 'Courier New', monospace;
            color: var(--text);
            border-right: 5px solid var(--primary);
            font-size: 1rem;
            line-height: 1.5;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background-color: var(--primary);
            color: white;
            padding: 1rem 2rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            margin: 0.5rem 0.5rem 0.5rem 0;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: var(--accent);
            color: var(--text);
        }
        
        .btn-secondary:hover {
            background-color: #7cb342;
        }
        
        footer {
            background-color: var(--secondary);
            text-align: center;
            padding: 3rem 1rem;
            margin-top: 4rem;
            color: var(--text);
        }
        
        .screenshot {
            width: 100%;
            max-width: 900px;
            margin: 1.5rem auto;
            display: block;
            border-radius: 10px;
            box-shadow: 0 6px 15px var(--shadow);
            border: 2px solid var(--accent);
        }
        
        .logo {
            font-size: 4rem;
            color: white;
            margin-bottom: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .commands {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .command-item {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            border-right: 4px solid var(--primary);
            transition: transform 0.2s;
        }
        
        .command-item:hover {
            transform: translateX(5px);
        }
        
        .command-item code {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1rem;
            background: var(--code-bg);
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
        }
        
        .highlight {
            background: linear-gradient(120deg, var(--accent) 0%, var(--accent) 100%);
            background-repeat: no-repeat;
            background-size: 100% 0.4em;
            background-position: 0 88%;
            font-weight: bold;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 1.5rem;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 8px var(--shadow);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .demo-terminal {
            background: #1e1e1e;
            color: #00ff00;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
            font-family: 'Courier New', monospace;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
        
        .demo-line {
            margin-bottom: 0.5rem;
        }
        
        .demo-prompt {
            color: #ffff00;
        }
        
        .demo-output {
            color: #00ffff;
        }
        
        .demo-highlight {
            color: #ff6b6b;
            font-weight: bold;
        }

        /* أنماط جديدة للعرض الحي */
        .live-prayer-widget {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            border: 2px solid var(--primary);
            text-align: center;
        }

        .prayer-info {
            font-size: 1.2rem;
            margin: 1rem 0;
        }

        .next-prayer {
            color: var(--primary);
            font-weight: bold;
            font-size: 1.4rem;
            margin: 1rem 0;
        }

        .location-info {
            color: var(--text-light);
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .loading {
            color: var(--text-light);
            font-style: italic;
        }

        .error {
            color: #ff6b6b;
            font-weight: bold;
        }

        .refresh-btn {
            background: var(--accent);
            color: var(--text);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            margin: 1rem 0;
            font-weight: bold;
            font-size: 1rem;
        }

        .refresh-btn:hover {
            background: #7cb342;
        }

        .prayer-times-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .prayer-time-item {
            background: var(--background);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--accent);
        }

        .prayer-time-item.next {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .prayer-name {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .prayer-time {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .method-selector {
            background: var(--background);
            border: 1px solid var(--accent);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: right;
        }

        .method-info {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        .method-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }

        .method-btn:hover {
            background: var(--primary-dark);
        }

        .manual-location-form {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            display: none;
        }

        .time-adjustment-form {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--accent);
            border-radius: 4px;
            background: var(--background);
            color: var(--text);
        }

        .location-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .time-adjustment-info {
            background: var(--accent);
            color: var(--text);
            padding: 0.8rem;
            border-radius: 4px;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        .adjustment-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin: 1rem 0;
        }

        .adjustment-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .adjustment-value {
            font-size: 1.2rem;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }

        .auto-detection-status {
            background: var(--accent);
            color: var(--text);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin: 0.5rem 0;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .auto-detection-status.success {
            background: #4caf50;
            color: white;
        }

        .auto-detection-status.warning {
            background: #ff9800;
            color: white;
        }

        .auto-detection-status.error {
            background: #f44336;
            color: white;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2.2rem;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .commands {
                grid-template-columns: 1fr;
            }
            
            .theme-toggle {
                top: 0.5rem;
                left: 0.5rem;
                width: 40px;
                height: 40px;
            }
            
            .btn {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }

            .prayer-times-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .location-actions {
                flex-direction: column;
            }

            .adjustment-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <button class="theme-toggle" id="themeToggle">
            <i class="fas fa-moon"></i>
        </button>
        <div class="logo">
            <i class="fas fa-mosque"></i>
        </div>
        <h1>GT-salat-dikr 🕌</h1>
        <p>نظام إشعارات الصلاة والأذكار المتكامل - يعمل على جميع توزيعات لينكس</p>
        <p>مفتوح المصدر ⚡ مرخص تحت GPL 📜</p>
    </header>
    
    <div class="container">
        <section id="intro">
            <h2><i class="fas fa-info-circle"></i> نظام متكامل لتذكير الصلاة والأذكار</h2>
            <p>GT-salat-dikr هو نظام متكامل يجمع بين دقة مواقيت الصلاة وقوة التذكير المستمر للأذكار. مصمم خصيصًا لمستخدمي لينكس الذين يبحثون عن حل تقني متكامل يساعدهم على الالتزام بالعبادات اليومية.</p>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number">120+</div>
                    <div>ذكر متنوع</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">25</div>
                    <div>طريقة حساب</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">20+</div>
                    <div>بيئة مدعومة</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">100%</div>
                    <div>مفتوح المصدر</div>
                </div>
            </div>

            // دالة محسنة لمواقيت الصلاة الحية
class PrayerTimesManager {
    constructor() {
        this.userLocation = null;
        this.timeAdjustment = 0;
        this.currentMethod = 'auto';
        this.isSummerTime = 'auto';
        this.prayerMethods = {
            'MWL': { name: 'رابطة العالم الإسلامي', id: 3, params: { fajr: 18, isha: 17 } },
            'ISNA': { name: 'الجمعية الإسلامية لأمريكا الشمالية', id: 2, params: { fajr: 15, isha: 15 } },
            'Egypt': { name: 'هيئة المساحة المصرية', id: 5, params: { fajr: 19.5, isha: 17.5 } },
            'Makkah': { name: 'أم القرى بمكة المكرمة', id: 4, params: { fajr: 18.5, isha: '90 min' } },
            'Karachi': { name: 'جامعة العلوم الإسلامية بكراتشي', id: 1, params: { fajr: 18, isha: 18 } },
            'Tehran': { name: 'معهد الجيوفيزياء بجامعة طهران', id: 7, params: { fajr: 17.7, isha: 14 } },
            'Jafari': { name: 'الجفري', id: 0, params: { fajr: 16, isha: 14 } }
        };
        this.summerTimeCountries = ['المملكة المتحدة', 'بريطانيا', 'أوروبا', 'الولايات المتحدة', 'كندا', 'فرنسا', 'ألمانيا'];
    }

    // دالة تحميل مواقيت الصلاة الرئيسية
    async loadPrayerTimes() {
        const prayerWidget = document.getElementById('prayerWidget');
        const locationInfo = document.getElementById('locationInfo');
        const autoDetectionStatus = document.getElementById('autoDetectionStatus');
        
        prayerWidget.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> جاري تحميل مواقيت الصلاة...</div>';
        
        try {
            // اكتشاف الموقع التلقائي
            if (!this.userLocation) {
                await this.autoDetectLocation();
            }
            
            // تحديث معلومات الموقع
            this.updateLocationInfo();
            
            // تحديد طريقة الحساب المناسبة
            this.determineCalculationMethod();
            
            // تحديد إعدادات التوقيت الصيفي
            this.determineSummerTimeSettings();
            
            // جلب مواقيت الصلاة الحقيقية
            const prayerTimes = await this.fetchPrayerTimes();
            
            // عرض مواقيت الصلاة
            this.displayPrayerTimes(prayerTimes);
            
            autoDetectionStatus.innerHTML = '<i class="fas fa-check-circle"></i> تم تحميل مواقيت الصلاة بنجاح!';
            autoDetectionStatus.className = 'auto-detection-status success';
            
        } catch (error) {
            console.error('Error loading prayer times:', error);
            this.handleError(error, prayerWidget, autoDetectionStatus);
        }
    }

    // اكتشاف الموقع التلقائي
    async autoDetectLocation() {
        const statusElement = document.getElementById('autoDetectionStatus');
        statusElement.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> جاري اكتشاف موقعك...';
        
        return new Promise((resolve, reject) => {
            if (!navigator.geolocation) {
                this.useDefaultLocation();
                resolve();
                return;
            }

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    try {
                        this.userLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            city: '',
                            country: '',
                            timezone: ''
                        };

                        // الحصول على معلومات الموقع من خدمة reverse geocoding
                        await this.getLocationDetails();
                        resolve();
                    } catch (error) {
                        this.useDefaultLocation();
                        resolve();
                    }
                },
                (error) => {
                    console.warn('Geolocation failed, using default location:', error);
                    this.useDefaultLocation();
                    resolve();
                },
                {
                    enableHighAccuracy: false,
                    timeout: 10000,
                    maximumAge: 3600000
                }
            );
        });
    }

    // استخدام الموقع الافتراضي (مكة المكرمة)
    useDefaultLocation() {
        this.userLocation = {
            latitude: 21.4225,
            longitude: 39.8262,
            city: 'مكة المكرمة',
            country: 'السعودية',
            timezone: 'Asia/Riyadh'
        };
    }

    // الحصول على تفاصيل الموقع
    async getLocationDetails() {
        try {
            const response = await fetch(
                `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${this.userLocation.latitude}&longitude=${this.userLocation.longitude}&localityLanguage=ar`
            );
            
            if (response.ok) {
                const data = await response.json();
                this.userLocation.city = data.city || data.locality || 'غير معروف';
                this.userLocation.country = data.countryName || 'غير معروف';
                this.userLocation.timezone = data.timezone || 'Asia/Riyadh';
            }
        } catch (error) {
            console.warn('Failed to get location details:', error);
            this.userLocation.city = 'غير معروف';
            this.userLocation.country = 'غير معروف';
            this.userLocation.timezone = 'Asia/Riyadh';
        }
    }

    // تحديث معلومات الموقع في الواجهة
    updateLocationInfo() {
        const locationInfo = document.getElementById('locationInfo');
        const city = this.userLocation.city || 'غير معروف';
        const country = this.userLocation.country || 'غير معروف';
        
        locationInfo.innerHTML = `
            <i class="fas fa-map-marker-alt"></i> ${city}, ${country}
            <br><small>الإحداثيات: ${this.userLocation.latitude.toFixed(4)}, ${this.userLocation.longitude.toFixed(4)}</small>
        `;
    }

    // تحديد طريقة الحساب المناسبة حسب الموقع
    determineCalculationMethod() {
        const country = this.userLocation.country.toLowerCase();
        
        if (country.includes('السعودية') || country.includes('saudi')) {
            this.currentMethod = 'Makkah';
        } else if (country.includes('مصر') || country.includes('egypt')) {
            this.currentMethod = 'Egypt';
        } else if (country.includes('تركيا') || country.includes('turkey')) {
            this.currentMethod = 'MWL';
        } else if (country.includes('باكستان') || country.includes('pakistan')) {
            this.currentMethod = 'Karachi';
        } else if (country.includes('إيران') || country.includes('iran')) {
            this.currentMethod = 'Tehran';
        } else if (country.includes('أمريكا') || country.includes('united states') || country.includes('كندا') || country.includes('canada')) {
            this.currentMethod = 'ISNA';
        } else {
            this.currentMethod = 'MWL';
        }

        // تحديث الواجهة
        const methodInfo = this.prayerMethods[this.currentMethod];
        document.getElementById('currentMethod').innerHTML = `طريقة الحساب: ${methodInfo.name}`;
        document.getElementById('methodInfo').innerHTML = `تم اختيار طريقة الحساب المناسبة تلقائيًا حسب موقعك`;
    }

    // تحديد إعدادات التوقيت الصيفي
    determineSummerTimeSettings() {
        const country = this.userLocation.country;
        const now = new Date();
        const isSummer = now.getMonth() >= 3 && now.getMonth() <= 9; // أبريل إلى أكتوبر
        
        const usesSummerTime = this.summerTimeCountries.some(summerCountry => 
            country.includes(summerCountry)
        );

        if (usesSummerTime && isSummer) {
            this.isSummerTime = 'on';
            this.timeAdjustment = 1;
        } else {
            this.isSummerTime = 'off';
            this.timeAdjustment = 0;
        }

        // تحديث الواجهة
        document.getElementById('summerTime').value = this.isSummerTime;
        document.getElementById('timeAdjustment').textContent = this.timeAdjustment;
    }

    // جلب مواقيت الصلاة من API
    async fetchPrayerTimes() {
        const today = new Date();
        const dateString = today.toISOString().split('T')[0];
        const methodId = this.prayerMethods[this.currentMethod].id;

        try {
            // استخدام Aladhan API
            const response = await fetch(
                `https://api.aladhan.com/v1/timings/${dateString}?latitude=${this.userLocation.latitude}&longitude=${this.userLocation.longitude}&method=${methodId}&tune=0,0,0,0,0,0,0,0,0`
            );

            if (!response.ok) {
                throw new Error('فشل في جلب مواقيت الصلاة من الخادم');
            }

            const data = await response.json();
            
            if (data.code !== 200) {
                throw new Error(data.data || 'حدث خطأ في الخادم');
            }

            return this.processPrayerTimes(data.data.timings);
            
        } catch (error) {
            console.warn('API failed, using calculated times:', error);
            return this.calculatePrayerTimes();
        }
    }

    // معالجة مواقيت الصلاة من API
    processPrayerTimes(timings) {
        const adjustedTimes = {};
        const prayerKeys = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
        
        prayerKeys.forEach(key => {
            let time = timings[key];
            
            // تطبيق تعديل الوقت
            if (this.timeAdjustment !== 0) {
                time = this.adjustTime(time, this.timeAdjustment);
            }
            
            adjustedTimes[key.toLowerCase()] = time;
        });

        return adjustedTimes;
    }

    // حساب مواقيت الصلاة محليًا (بديل عند فشل API)
    calculatePrayerTimes() {
        // حسابات مبسطة لمواقيت الصلاة (يمكن استبدالها بخوارزمية دقيقة)
        const now = new Date();
        const lat = this.userLocation.latitude;
        const long = this.userLocation.longitude;
        
        // حسابات تقريبية (هذه مجرد مثال، تحتاج لخوارزمية دقيقة)
        const sunrise = this.calculateSunTime(lat, long, now, 90.833); // شروق الشمس
        const fajr = new Date(sunrise.getTime() - (90 * 60 * 1000)); // قبل الشروق بساعة ونصف
        const dhuhr = new Date(sunrise.getTime() + (6 * 60 * 60 * 1000)); // بعد الشروق بـ6 ساعات
        const asr = new Date(dhuhr.getTime() + (3 * 60 * 60 * 1000)); // بعد الظهر بـ3 ساعات
        const maghrib = this.calculateSunTime(lat, long, now, 90.833); // غروب الشمس
        const isha = new Date(maghrib.getTime() + (90 * 60 * 1000)); // بعد المغرب بساعة ونصف

        const times = {
            fajr: this.formatTime(fajr),
            sunrise: this.formatTime(sunrise),
            dhuhr: this.formatTime(dhuhr),
            asr: this.formatTime(asr),
            maghrib: this.formatTime(maghrib),
            isha: this.formatTime(isha)
        };

        // تطبيق تعديل الوقت
        if (this.timeAdjustment !== 0) {
            Object.keys(times).forEach(key => {
                times[key] = this.adjustTimeString(times[key], this.timeAdjustment);
            });
        }

        return times;
    }

    // حساب وقت الشروق/الغروب (دالة مبسطة)
    calculateSunTime(lat, long, date, angle) {
        // هذه دالة مبسطة، في التطبيق الحقيقي تحتاج لخوارزمية دقيقة
        const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
        const approxTime = new Date(date);
        
        // حساب تقريبي (هذا مجرد مثال)
        const timeCorrection = 4 * (long - 15 * (date.getTimezoneOffset() / 60));
        const solarNoon = 12 - timeCorrection / 60;
        
        approxTime.setHours(Math.floor(solarNoon));
        approxTime.setMinutes(Math.round((solarNoon % 1) * 60));
        
        return approxTime;
    }

    // تنسيق الوقت
    formatTime(date) {
        return date.toLocaleTimeString('ar-SA', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: false 
        }).slice(0, 5);
    }

    // تعديل وقت النص
    adjustTimeString(timeStr, adjustment) {
        const [hours, minutes] = timeStr.split(':').map(Number);
        let adjustedHours = hours + adjustment;
        
        if (adjustedHours < 0) adjustedHours += 24;
        if (adjustedHours >= 24) adjustedHours -= 24;
        
        return `${adjustedHours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
    }

    // تعديل الوقت من كائن Date
    adjustTime(timeStr, adjustment) {
        return this.adjustTimeString(timeStr, adjustment);
    }

    // عرض مواقيت الصلاة
    displayPrayerTimes(prayerTimes) {
        const prayerWidget = document.getElementById('prayerWidget');
        const prayers = [
            { name: 'الفجر', time: prayerTimes.fajr, key: 'fajr' },
            { name: 'الشروق', time: prayerTimes.sunrise, key: 'sunrise' },
            { name: 'الظهر', time: prayerTimes.dhuhr, key: 'dhuhr' },
            { name: 'العصر', time: prayerTimes.asr, key: 'asr' },
            { name: 'المغرب', time: prayerTimes.maghrib, key: 'maghrib' },
            { name: 'العشاء', time: prayerTimes.isha, key: 'isha' }
        ];

        // تحديد الصلاة التالية
        const now = new Date();
        const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        
        let nextPrayer = null;
        let timeRemaining = '';
        
        for (const prayer of prayers) {
            if (prayer.time > currentTime) {
                nextPrayer = prayer;
                timeRemaining = this.calculateTimeRemaining(currentTime, prayer.time);
                break;
            }
        }
        
        // إذا لم توجد صلاة تالية اليوم، نستخدم الفجر غدًا
        if (!nextPrayer) {
            nextPrayer = prayers[0];
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            timeRemaining = `غدًا الساعة ${nextPrayer.time}`;
        }

        // بناء واجهة العرض
        let html = `
            <div class="next-prayer">
                <i class="fas fa-clock"></i> الصلاة القادمة: ${nextPrayer.name} - ${nextPrayer.time}
                ${timeRemaining ? `<br><small>(${timeRemaining})</small>` : ''}
            </div>
            
            ${this.timeAdjustment !== 0 ? `
                <div class="prayer-info" style="color: var(--accent); font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i> تم تعديل المواقيت بمقدار ${this.timeAdjustment > 0 ? '+' : ''}${this.timeAdjustment} ساعة
                </div>
            ` : ''}
            
            <div class="prayer-times-grid">
        `;
        
        prayers.forEach(prayer => {
            const isNext = prayer === nextPrayer;
            html += `
                <div class="prayer-time-item ${isNext ? 'next' : ''}">
                    <div class="prayer-name">${prayer.name}</div>
                    <div class="prayer-time">${prayer.time}</div>
                </div>
            `;
        });
        
        html += `</div>`;
        
        // إضافة ذكر عشوائي
        const azkar = [
            "سُبْحَانَ اللَّهِ وَبِحَمْدِهِ، سُبْحَانَ اللَّهِ الْعَظِيمِ",
            "لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ",
            "اللَّهُمَّ صَلِّ عَلَى مُحَمَّدٍ وَعَلَى آلِ مُحَمَّدٍ",
            "أسْتَغْفِرُ اللَّهِ الْعَظِيمَ الَّذِي لَا إِلَهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ وَأَتُوبُ إِلَيْهِ"
        ];
        
        const randomZikr = azkar[Math.floor(Math.random() * azkar.length)];
        html += `<div class="prayer-info"><i class="fas fa-heart"></i> ${randomZikr}</div>`;
        
        prayerWidget.innerHTML = html;
    }

    // حساب الوقت المتبقي للصلاة التالية
    calculateTimeRemaining(currentTime, prayerTime) {
        const [currentHours, currentMinutes] = currentTime.split(':').map(Number);
        const [prayerHours, prayerMinutes] = prayerTime.split(':').map(Number);
        
        let currentTotal = currentHours * 60 + currentMinutes;
        let prayerTotal = prayerHours * 60 + prayerMinutes;
        
        if (prayerTotal <= currentTotal) {
            prayerTotal += 24 * 60; // إذا كانت الصلاة في اليوم التالي
        }
        
        const remainingMinutes = prayerTotal - currentTotal;
        const hours = Math.floor(remainingMinutes / 60);
        const minutes = remainingMinutes % 60;
        
        if (hours > 0) {
            return `باقي ${hours} ساعة و ${minutes} دقيقة`;
        } else {
            return `باقي ${minutes} دقيقة`;
        }
    }

    // معالجة الأخطاء
    handleError(error, prayerWidget, autoDetectionStatus) {
        let errorMessage = 'حدث خطأ غير متوقع';
        
        if (error.message.includes('فشل في جلب')) {
            errorMessage = 'تعذر الاتصال بخادم مواقيت الصلاة';
        } else if (error.message.includes('الموقع')) {
            errorMessage = 'تعذر اكتشاف موقعك، تم استخدام الموقع الافتراضي';
        }
        
        prayerWidget.innerHTML = `
            <div class="error">
                <i class="fas fa-exclamation-triangle"></i> ${errorMessage}
                <br><small>يرجى المحاولة مرة أخرى أو تحديد الموقع يدويًا</small>
            </div>
        `;
        
        autoDetectionStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> فشل في تحميل المواقيت';
        autoDetectionStatus.className = 'auto-detection-status error';
    }

    // تغيير طريقة الحساب
    changeCalculationMethod(methodKey) {
        if (this.prayerMethods[methodKey]) {
            this.currentMethod = methodKey;
            const methodInfo = this.prayerMethods[methodKey];
            document.getElementById('currentMethod').innerHTML = `طريقة الحساب: ${methodInfo.name}`;
            this.loadPrayerTimes();
        }
    }

    // تطبيق الموقع اليدوي
    applyManualLocation(lat, lon, city, country) {
        this.userLocation = {
            latitude: parseFloat(lat),
            longitude: parseFloat(lon),
            city: city,
            country: country,
            timezone: 'Asia/Riyadh'
        };
        
        document.getElementById('autoDetectionStatus').innerHTML = '<i class="fas fa-check-circle"></i> تم تحديث الموقع يدويًا بنجاح!';
        document.getElementById('autoDetectionStatus').className = 'auto-detection-status success';
        
        this.loadPrayerTimes();
    }
}

// إنشاء كائن إدارة مواقيت الصلاة
const prayerManager = new PrayerTimesManager();

// دالة التحميل الرئيسية
async function loadPrayerTimes() {
    await prayerManager.loadPrayerTimes();
}

// دالة تعديل الوقت
function adjustTime(amount) {
    prayerManager.timeAdjustment += amount;
    
    // الحد من نطاق التعديل (-12 إلى +12 ساعة)
    if (prayerManager.timeAdjustment > 12) prayerManager.timeAdjustment = 12;
    if (prayerManager.timeAdjustment < -12) prayerManager.timeAdjustment = -12;
    
    document.getElementById('timeAdjustment').textContent = prayerManager.timeAdjustment;
    prayerManager.loadPrayerTimes();
}

// دالة إعادة ضبط التعديل
function resetTimeAdjustment() {
    prayerManager.timeAdjustment = 0;
    document.getElementById('timeAdjustment').textContent = prayerManager.timeAdjustment;
    prayerManager.loadPrayerTimes();
}

// دالة تبديل التوقيت الصيفي
function toggleSummerTime() {
    const summerTimeSelect = document.getElementById('summerTime');
    prayerManager.isSummerTime = summerTimeSelect.value;
    prayerManager.determineSummerTimeSettings();
    prayerManager.loadPrayerTimes();
}

// دالة عرض محدد طريقة الحساب
function showMethodSelector() {
    const methods = prayerManager.prayerMethods;
    let methodList = 'اختر طريقة حساب مواقيت الصلاة:\n\n';
    
    Object.keys(methods).forEach((key, index) => {
        methodList += `${index + 1}) ${methods[key].name}\n`;
    });
    
    const selected = prompt(methodList + '\nأدخل الرقم:');
    
    if (selected && !isNaN(selected)) {
        const index = parseInt(selected) - 1;
        const methodKeys = Object.keys(methods);
        
        if (index >= 0 && index < methodKeys.length) {
            prayerManager.changeCalculationMethod(methodKeys[index]);
        }
    }
}

// دالة تطبيق الموقع اليدوي
function applyManualLocation() {
    const lat = document.getElementById('manualLat').value;
    const lon = document.getElementById('manualLon').value;
    const city = document.getElementById('manualCity').value;
    const country = document.getElementById('manualCountry').value;
    
    if (!lat || !lon) {
        alert('يرجى إدخال الإحداثيات على الأقل');
        return;
    }
    
    prayerManager.applyManualLocation(lat, lon, city, country);
    toggleManualLocation();
}

// تحميل مواقيت الصلاة عند فتح الصفحة
window.addEventListener('DOMContentLoaded', loadPrayerTimes);

// تحديث المواقيت كل ساعة
setInterval(loadPrayerTimes, 60 * 60 * 1000);
            
            <div class="demo-terminal">
                <div class="demo-line"><span class="demo-prompt">$</span> <span class="demo-output">gtsalat</span></div>
                <div class="demo-line">سُبْحَانَ اللَّهِ وَبِحَمْدِهِ، سُبْحَانَ اللَّهِ الْعَظِيمِ</div>
                <div class="demo-line"></div>
                <div class="demo-line"><span class="demo-highlight">🕌 الصلاة القادمة: العصر عند 15:30 (باقي 02:15)</span></div>
            </div>
            
            <a href="https://github.com/SalehGNUTUX/GT-salat-dikr" class="btn">
                <i class="fab fa-github"></i> استعراض الكود المصدري
            </a>
            <a href="#installation" class="btn btn-secondary">
                <i class="fas fa-download"></i> التثبيت الفوري
            </a>
        </section>
        
        <!-- الأقسام الأخرى تبقى كما هي -->
        <section id="features">
            <h2><i class="fas fa-star"></i> الميزات المتقدمة</h2>
            <div class="features">
                <div class="feature-card">
                    <h3><i class="fas fa-book-quran"></i> أذكار شاملة ومتنوعة</h3>
                    <p>قاعدة بيانات شاملة تحتوي على أكثر من 120 ذكر متنوع من الأذكار الإسلامية الموثوقة، مع تحديث تلقائي من المصادر المعتمدة.</p>
                </div>
                
                <div class="feature-card">
                    <h3><i class="fas fa-clock"></i> مواقيت صلاة دقيقة</h3>
                    <p>حساب تلقائي لمواقيت الصلاة بدقة عالية بناءً على موقعك الجغرافي، مع دعم 25 طريقة حساب مختلفة من جميع أنحاء العالم الإسلامي.</p>
                </div>
                
                <div class="feature-card">
                    <h3><i class="fas fa-bell"></i> إشعارات ذكية</h3>
                    <p>إشعارات تلقائية للأذكار على فترات زمنية قابلة للتخصيص، إشعار و تنبيه صوتي قبل الصلاة بـ10 دقائق، وإشعارات دخول وقت الصلاة مع تشغيل الأذان.</p>
                </div>
                
                <div class="feature-card">
                    <h3><i class="fas fa-desktop"></i> دعم جميع واجهات سطح المكتب</h3>
                    <p>توافق كامل مع GNOME, KDE, XFCE, i3, Sway, Awesome WM, Openbox, LXDE وجميع بيئات سطح المكتب الأخرى.</p>
                </div>
                
                <div class="feature-card">
                    <h3><i class="fas fa-terminal"></i> دعم جميع أنواع الطرفيات</h3>
                    <p>عمل متكامل مع Bash, Zsh, Fish, Ksh, Tcsh وجميع أنواع الشل، مع إعداد تلقائي لكل منها.</p>
                </div>
                
                <div class="feature-card">
                    <h3><i class="fas fa-sync-alt"></i> تحديث تلقائي</h3>
                    <p>تحديث تلقائي للبرنامج والأذكار، مع خيار التحديث اليدوي والحفاظ على الإعدادات الشخصية.</p>
                </div>
            </div>
        </section>
        
        <section id="installation">
            <h2><i class="fas fa-download"></i> التثبيت السريع</h2>
            
            <h3><i class="fas fa-bolt"></i> التثبيت التلقائي (مستحسن)</h3>
            <p>نسخة واحدة تشمل كل شيء - التثبيت، الإعدادات، البدء التلقائي:</p>
            <div class="code-block">
bash -c "$(curl -fsSL https://raw.githubusercontent.com/SalehGNUTUX/GT-salat-dikr/main/install.sh)"
            </div>
            
            <h3><i class="fas fa-cogs"></i> التثبيت اليدوي للمستخدمين المتقدمين</h3>
            <div class="code-block">
git clone https://github.com/SalehGNUTUX/GT-salat-dikr.git<br>cd GT-salat-dikr<br>chmod +x install.sh<br>./install.sh
            </div>
            
            <h3><i class="fas fa-trash"></i> إزالة التثبيت</h3>
            <div class="code-block">
bash -c "$(curl -fsSL https://raw.githubusercontent.com/SalehGNUTUX/GT-salat-dikr/main/uninstall.sh)"
            </div>
        </section>
        
        <section id="usage">
            <h2><i class="fas fa-terminal"></i> الأوامر المتاحة</h2>
            
            <div class="commands">
                <div class="command-item">
                    <p><code>gtsalat</code> - التشغيل العادي (عرض ذكر ومعلومات الصلاة القادمة)</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --show-timetable</code> - عرض مواقيت الصلاة كاملة لليوم</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat -t</code> - اختصار لعرض مواقيت الصلاة</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --settings</code> - إعدادات الموقع وطريقة الحساب</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --notify-start</code> - تشغيل الإشعارات التلقائية</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --notify-stop</code> - إيقاف الإشعارات</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --test-notify</code> - اختبار الإشعارات</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --test-adhan</code> - اختبار تشغيل الأذان</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --test-approaching</code> - اختبار تنبيه اقتراب وقت الصلاة</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --update-azkar</code> - تحديث الأذكار من الإنترنت</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --self-update</code> - تحديث البرنامج نفسه</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --status</code> - عرض حالة البرنامج</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --logs</code> - عرض سجل التشغيل</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --debug</code> - معلومات التشخيص</p>
                </div>
                <div class="command-item">
                    <p><code>gtsalat --help</code> - عرض المساعدة الكاملة</p>
                </div>
            </div>
        </section>
        
        <section id="screenshots">
            <h2><i class="fas fa-desktop"></i> أمثلة حية من البرنامج</h2>
            
            <h3>عرض الذكر وموعد الصلاة القادمة:</h3>
            <div class="code-block">
# عند فتح الطرفية تلقائيًا:<br>لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير<br><br>🕌 الصلاة القادمة: العصر عند 15:30 (باقي 02:15)
            </div>
            
            <h3>جدول المواقيت الكامل:</h3>
            <div class="code-block">
مواقيت الصلاة اليوم (الرياض):<br>      الفجر: 04:30<br>    الشروق: 05:45<br>      الظهر: 12:15<br>      العصر: 15:30  ← القادمة<br>     المغرب: 18:45<br>     العشاء: 20:00
            </div>
            
            <h3>حالة البرنامج المتقدمة:</h3>
            <div class="code-block">
📊 حالة GT-salat-dikr:<br>════════════════════════════════<br>✅ الإشعارات: تعمل (PID: 2543)<br><br>📍 الموقع: الرياض, السعودية<br>🧭 الإحداثيات: 24.7136, 46.6753<br>📖 طريقة الحساب: Umm Al-Qura University, Makkah<br><br>🕌 الصلاة القادمة: العصر<br>⏰ الوقت: 15:30<br>⏳ المتبقي: 02:15
            </div>
        </section>
        
        <section id="technical">
            <h2><i class="fas fa-cogs"></i> المعلومات التقنية</h2>
            
            <h3>المتطلبات الأساسية:</h3>
            <ul>
                <li>نظام لينكس (أي توزيعة)</li>
                <li>Bash 4.0 أو أحدث</li>
                <li>curl لتحميل الملفات</li>
                <li>jq لمعالجة JSON (اختياري لكن مستحسن)</li>
                <li>libnotify للإشعارات</li>
            </ul>
            
            <h3>الميزات التقنية:</h3>
            <ul>
                <li>دعم نظامي init: systemd و XDG autostart</li>
                <li>إدارة عمليات خلفية ذكية</li>
                <li>سجل أخطاء مفصل</li>
                <li>اكتشاف تلقائي للموقع الجغرافي</li>
                <li>واجهة رسومية للأذان (zenity/yad/kdialog)</li>
                <li>دعم مشغلات صوت متعددة (mpv, ffplay, paplay, ogg123)</li>
            </ul>
        </section>
        
        <section id="license">
            <h2><i class="fas fa-balance-scale"></i> الترخيص والمشاركة</h2>
            <p>هذا البرنامج مرخص تحت <span class="highlight">رخصة جنو العمومية (GPL v3)</span>. يمكنك:</p>
            <ul>
                <li>استخدام البرنامج مجانًا لأي غرض</li>
                <li>تعديل الشفرة المصدرية كما تشاء</li>
                <li>توزيع نسخ معدلة مع الإشارة إلى التغييرات</li>
                <li>المساهمة في تطوير المشروع</li>
            </ul>
            
            <p>المشروع مبني على فلسفة البرمجيات الحرة، ونرحب بجميع المساهمات والتطويرات.</p>
            
            <a href="https://github.com/SalehGNUTUX/GT-salat-dikr" class="btn">
                <i class="fas fa-code"></i> المساهمة في التطوير
            </a>
            <a href="https://github.com/SalehGNUTUX/GT-salat-dikr/issues" class="btn btn-secondary">
                <i class="fas fa-bug"></i> الإبلاغ عن مشكلة
            </a>
        </section>
    </div>
    
    <footer>
        <div class="container">
            <p>GT-salat-dikr - نظام إشعارات الصلاة والأذكار المتكامل</p>
            <p>تم التطوير بواسطة <a href="https://github.com/SalehGNUTUX">SalehGNUTUX</a> - مرخص تحت <a href="https://github.com/SalehGNUTUX/GT-salat-dikr/blob/main/LICENSE">GPL v3</a></p>
            <p>🌙 نسخة حديثة ومطورة - 2025</p>
        </div>
    </footer>

    <script>
        // تبديل الوضع المظلم
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('i');
        
        // التحقق من التفضيل المحفوظ
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
        }
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            
            if (currentTheme === 'dark') {
                document.documentElement.removeAttribute('data-theme');
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
                localStorage.setItem('theme', 'dark');
            }
        });
        
        // تأثيرات scroll suave
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // كود عرض الصلاة الحي
        let userLocation = null;
        let timeAdjustment = 0;
        let currentMethod = 'auto';
        let isSummerTime = 'auto';

        // دالة تحميل مواقيت الصلاة
        async function loadPrayerTimes() {
            const prayerWidget = document.getElementById('prayerWidget');
            const locationInfo = document.getElementById('locationInfo');
            const autoDetectionStatus = document.getElementById('autoDetectionStatus');
            
            prayerWidget.innerHTML = '<div class="loading">جاري تحميل مواقيت الصلاة...</div>';
            
            try {
                // محاكاة اكتشاف الموقع التلقائي
                if (!userLocation) {
                    autoDetectionStatus.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> جاري اكتشاف موقعك وتحديد الإعدادات تلقائيًا...';
                    
                    // محاكاة تأخير لاكتشاف الموقع
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // محاكاة بيانات الموقع (يمكن استبدالها ببيانات حقيقية)
                    userLocation = {
                        latitude: 24.7136,
                        longitude: 46.6753,
                        city: 'الرياض',
                        country: 'السعودية',
                        timezone: 'Asia/Riyadh',
                        method: 'Umm Al-Qura University, Makkah'
                    };
                    
                    autoDetectionStatus.innerHTML = '<i class="fas fa-check-circle"></i> تم اكتشاف موقعك تلقائيًا بنجاح!';
                    autoDetectionStatus.classList.add('success');
                }
                
                // تحديث معلومات الموقع
                locationInfo.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${userLocation.city}, ${userLocation.country} (${userLocation.latitude.toFixed(4)}, ${userLocation.longitude.toFixed(4)})`;
                
                // تحديث طريقة الحساب
                document.getElementById('currentMethod').innerHTML = `طريقة الحساب: ${userLocation.method}`;
                document.getElementById('methodInfo').innerHTML = `يتم استخدام طريقة الحساب المناسبة تلقائيًا حسب موقعك (${userLocation.method})`;
                
                // محاكاة مواقيت الصلاة (يمكن استبدالها ببيانات حقيقية من API)
                const prayerTimes = generatePrayerTimes();
                
                // عرض مواقيت الصلاة
                displayPrayerTimes(prayerTimes);
                
            } catch (error) {
                console.error('Error loading prayer times:', error);
                prayerWidget.innerHTML = `<div class="error">حدث خطأ في تحميل مواقيت الصلاة. يرجى المحاولة مرة أخرى.</div>`;
                autoDetectionStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> فشل في اكتشاف الموقع تلقائيًا. يرجى تحديده يدويًا.';
                autoDetectionStatus.classList.add('error');
            }
        }
        
        // دالة توليد مواقيت الصلاة (محاكاة)
        function generatePrayerTimes() {
            const now = new Date();
            const today = now.toLocaleDateString('ar-SA');
            
            // مواقيت افتراضية (يمكن استبدالها بحسابات حقيقية)
            return {
                date: today,
                fajr: adjustTimeForDisplay('04:30'),
                sunrise: adjustTimeForDisplay('05:45'),
                dhuhr: adjustTimeForDisplay('12:15'),
                asr: adjustTimeForDisplay('15:30'),
                maghrib: adjustTimeForDisplay('18:45'),
                isha: adjustTimeForDisplay('20:00')
            };
        }
        
        // دالة ضبط الوقت حسب التعديلات
        function adjustTimeForDisplay(timeStr) {
            if (timeAdjustment === 0) return timeStr;
            
            const [hours, minutes] = timeStr.split(':').map(Number);
            let adjustedHours = hours + timeAdjustment;
            
            if (adjustedHours < 0) adjustedHours += 24;
            if (adjustedHours >= 24) adjustedHours -= 24;
            
            return `${adjustedHours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }
        
        // دالة عرض مواقيت الصلاة
        function displayPrayerTimes(prayerTimes) {
            const prayerWidget = document.getElementById('prayerWidget');
            const prayers = [
                { name: 'الفجر', time: prayerTimes.fajr, key: 'fajr' },
                { name: 'الشروق', time: prayerTimes.sunrise, key: 'sunrise' },
                { name: 'الظهر', time: prayerTimes.dhuhr, key: 'dhuhr' },
                { name: 'العصر', time: prayerTimes.asr, key: 'asr' },
                { name: 'المغرب', time: prayerTimes.maghrib, key: 'maghrib' },
                { name: 'العشاء', time: prayerTimes.isha, key: 'isha' }
            ];
            
            // تحديد الصلاة التالية
            const now = new Date();
            const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            let nextPrayerIndex = -1;
            for (let i = 0; i < prayers.length; i++) {
                if (prayers[i].time > currentTime) {
                    nextPrayerIndex = i;
                    break;
                }
            }
            
            // إذا لم نجد صلاة تالية، نعتبر الفجر هو التالي
            if (nextPrayerIndex === -1) {
                nextPrayerIndex = 0;
            }
            
            // بناء واجهة عرض مواقيت الصلاة
            let html = `<div class="next-prayer">الصلاة القادمة: ${prayers[nextPrayerIndex].name} - ${prayers[nextPrayerIndex].time}</div>`;
            html += `<div class="prayer-times-grid">`;
            
            prayers.forEach((prayer, index) => {
                const isNext = index === nextPrayerIndex;
                html += `
                    <div class="prayer-time-item ${isNext ? 'next' : ''}">
                        <div class="prayer-name">${prayer.name}</div>
                        <div class="prayer-time">${prayer.time}</div>
                    </div>
                `;
            });
            
            html += `</div>`;
            prayerWidget.innerHTML = html;
        }
        
        // دالة تعديل الوقت
        function adjustTime(amount) {
            timeAdjustment += amount;
            document.getElementById('timeAdjustment').textContent = timeAdjustment;
            loadPrayerTimes();
        }
        
        // دالة إعادة ضبط التعديل
        function resetTimeAdjustment() {
            timeAdjustment = 0;
            document.getElementById('timeAdjustment').textContent = timeAdjustment;
            loadPrayerTimes();
        }
        
        // دالة تبديل التوقيت الصيفي
        function toggleSummerTime() {
            const summerTimeSelect = document.getElementById('summerTime');
            isSummerTime = summerTimeSelect.value;
            
            // محاكاة تأثير التوقيت الصيفي
            if (isSummerTime === 'on') {
                timeAdjustment = 1;
            } else if (isSummerTime === 'off') {
                timeAdjustment = 0;
            } else {
                // تلقائي - نستخدم القيمة الافتراضية للموقع
                timeAdjustment = 0;
            }
            
            document.getElementById('timeAdjustment').textContent = timeAdjustment;
            loadPrayerTimes();
        }
        
        // دالة عرض محدد طريقة الحساب
        function showMethodSelector() {
            alert('هذه الميزة تحت التطوير. في النسخة الكاملة، يمكنك اختيار من بين 25 طريقة حساب مختلفة.');
        }
        
        // دالة تبديل تحديد الموقع يدويًا
        function toggleManualLocation() {
            const manualForm = document.getElementById('manualLocationForm');
            if (manualForm.style.display === 'block') {
                manualForm.style.display = 'none';
            } else {
                manualForm.style.display = 'block';
            }
        }
        
        // دالة تطبيق الموقع اليدوي
        function applyManualLocation() {
            const lat = document.getElementById('manualLat').value;
            const lon = document.getElementById('manualLon').value;
            const city = document.getElementById('manualCity').value;
            const country = document.getElementById('manualCountry').value;
            
            if (!lat || !lon || !city || !country) {
                alert('يرجى ملء جميع الحقول');
                return;
            }
            
            userLocation = {
                latitude: parseFloat(lat),
                longitude: parseFloat(lon),
                city: city,
                country: country,
                timezone: 'Asia/Riyadh', // يمكن حسابها من الإحداثيات
                method: 'Umm Al-Qura University, Makkah'
            };
            
            document.getElementById('autoDetectionStatus').innerHTML = '<i class="fas fa-check-circle"></i> تم تحديث الموقع يدويًا بنجاح!';
            document.getElementById('autoDetectionStatus').classList.add('success');
            
            toggleManualLocation();
            loadPrayerTimes();
        }
        
        // تحميل مواقيت الصلاة عند فتح الصفحة
        window.addEventListener('DOMContentLoaded', loadPrayerTimes);
    </script>
</body>
</html>
